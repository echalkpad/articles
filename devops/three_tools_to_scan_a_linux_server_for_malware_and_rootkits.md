# Three tools to scan a Linux server for Malware and Rootkits

[Original URL](https://www.howtoforge.com/tutorial/how-to-scan-linux-for-malware-and-rootkits/)

> Servers connected to the internet are seeing a constant level of attacks and scans all day. While a firewall and regular system updates are a good first defense to keep the system safe, you should...

Servers connected to the internet are seeing a constant level of attacks and scans all day. While a firewall and regular system updates are a good first defense to keep the system safe, you should also check regularly that no attacker got in. The tools described in this tutorial are made for these sanity checks, they scan for malware, viruses and rootkits. They should be run regularly, e.g. every night and send reports to you by email. You can also use Chkrootkit, Rkhunter and ISPProtect to scan a system when you see suspicious activity like high load, suspicious processes or when the server suddenly starts to send malware.

All these scanners have to be run as root user. Login as root before you continue or run "sudo su" on Ubuntu to become root user.

## chkrootkit - Linux rootkit scanner

Chkrootkit is a classic rootkit scanner. It checks your server for suspicious rootkit processes and checks for a list of known rootkit files.

Either install the package that comes with your distribution (on Debian and Ubuntu you would run

apt-get install chkrootkit

), or download the sources from [www.chkrootkit.org](http://www.chkrootkit.org/) and install manually:

wget –passive-ftp ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz<br>
tar xvfz chkrootkit.tar.gz<br>
cd chkrootkit-*/<br>
make sense

Afterward, you can move the chkrootkit directory somewhere else, e.g. 

<span class="system">/usr/local/chkrootkit</span>

:

cd ..<br>
mv chkrootkit-<version>/ /usr/local/chkrootkit

and create a symlink for easy access:

ln -s /usr/local/chkrootkit/chkrootkit /usr/local/bin/chkrootkit

To check your server with chkrootkit, run the command:

chkrootkit

A common false positive report is:

Checking `bindshell'... INFECTED (PORTS: 465)

Don't worry when you get this message on an email server, this is the SMTPS (Secure SMTP) port of your mail system and a well known false positive.

You can even run chkrootkit by a cron job and get the results emailed to you. First, find out the path where chkrootkit is installed on your server with:

which chkrootkit

Example:

[[email protected]](https://www.howtoforge.com/cdn-cgi/l/email-protection):/tmp/chkrootkit-0.50# which chkrootkit<br>
/usr/sbin/chkrootkit

Chkrootkit is installed in the path /usr/sbin/chkrootkit, we need this path in the cron line below:

Run:

crontab -e

To create a cron job like this:

```
0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii /usr/sbin/chkrootkit 2>&1 | mail -s "chkrootkit output of my server" [email protected])
```

That would run chkrootkit every night a 3.00h. Replace the path to chkrootkit with the one that you got from which command above and exchange the email address with your real address.

## Lynis - Universal security auditing tool and rootkit scanner

Lynis (formerly rkhunter) is a security auditing tool for Linux and BSD based systems. It performs a detailed auditing of many security aspects and configurations of your system. Download the latest Lynis sources from <https://cisofy.com/download/lynis/>:

cd /tmp<br>
wget <https://cisofy.com/files/lynis-2.1.1.tar.gz><br>
tar xvfz 

<span>lynis-2.1.1.tar.gz</span>

<br>
mv lynis /usr/local/<br>
ln -s /usr/local/lynis/lynis /usr/local/bin/lynis

This will install lynis to the directory 

<span class="system">/usr/local/lynis</span>

 and creates a symlink for easy access. Now run

lynis update info

to check if you use the latest version.

Now you can scan your system for rootkits by running:

lynis audit system

Lynis will perform a few checks and then stops to give you some time to read the results. Press [ENTER] to continue with the scan.

[![Lynis system audit.](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/lynis.png)](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/lynis.png)

At the end, it will show you a summary of the scan.

[![Lynis result.](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/lynis21.png)](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/lynis21.png)

To run Lynis non-interactively, start it with the –quick option:

lynis –quick

To run Lynis automatically at night, create a cron job like this:

```
0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii /usr/local/bin/lynis --quick 2>&1 | mail -s "lynis output of my server" [email protected])
```

This will run lynis every night a 3.00h. Replace the email address with your real address.

## ISPProtect - Website malware scanner

[ISPProtect](http://ispprotect.com/) is a malware scanner for web servers, it scans for malware in website files and CMS systems like Wordpress, Joomla, Drupal etc. If you run a web hosting server, then the hosted websites are the most attacked part of your server and it is recommended to do sanity checks on them regularly. ISPProtect contains 3 scanning engines: a signature based malware scanner, a heuristic malware scanner, and a scanner to show the installation directories of outdated CMS systems. ISPProtect is not free software, but there is a free trial that can be used without registration to test it or clean an infected system.

ISPProtect requires PHP to be installed on the server, this should be the case on most hosting systems. In case you don't have a command line PHP installed yet, execute:

apt-get install php5-cli

on Debian or Ubuntu or:

yum install php

on Fedora and CentOS.

Run the following commands to install ISPProtect.

```
mkdir -p /usr/local/ispprotect
chown -R root:root /usr/local/ispprotect
chmod -R 750 /usr/local/ispprotect
cd /usr/local/ispprotect
wget http://www.ispprotect.com/download/ispp_scan.tar.gz
tar xzf ispp_scan.tar.gz
rm -f ispp_scan.tar.gz
ln -s /usr/local/ispprotect/ispp_scan /usr/local/bin/ispp_scan
```

To start ISPProtect, run:

ispp_scan

The scanner automatically checks for updates, then asks for the key (enter the word "trial" here) and then asks for the path of the websites, normally thats /var/www.

[![ISPProtect malware scan.](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/ispprotect.png)](https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/ispprotect.png)

Please enter scan key: <– trial<br>
Please enter path to scan: <– /var/www

The scanner will now start the scan. The scanning progress is shown. The names of the infected files are shown on the screen at the end of the scan and the results are stored in file sin the ISPProtect install directory for later use:

After the scan is completed, you will find the results also in the following files:<br>
Malware => /usr/local/ispprotect/found_malware_20161401174626.txt<br>
Wordpress => /usr/local/ispprotect/software_wordpress_20161401174626.txt<br>
Joomla => /usr/local/ispprotect/software_joomla_20161401174626.txt<br>
Drupal => /usr/local/ispprotect/software_drupal_20161401174626.txt<br>
Mediawiki => /usr/local/ispprotect/software_mediawiki_20161401174626.txt<br>
Contao => /usr/local/ispprotect/software_contao_20161401174626.txt<br>
Magentocommerce => /usr/local/ispprotect/software_magentocommerce_20161401174626.txt<br>
Woltlab Burning Board => /usr/local/ispprotect/software_woltlab_burning_board_20161401174626.txt<br>
Cms Made Simple => /usr/local/ispprotect/software_cms_made_simple_20161401174626.txt<br>
Phpmyadmin => /usr/local/ispprotect/software_phpmyadmin_20161401174626.txt<br>
Typo3 => /usr/local/ispprotect/software_typo3_20161401174626.txt<br>
Roundcube => /usr/local/ispprotect/software_roundcube_20161401174626.txt<br>
Starting scan level 1 ...

To run ISPProtect automatically as nightly cronjob, create a cron file with nano:

nano /etc/cron.d/ispprotect

and insert the following line:

```
0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii root   /usr/local/ispprotect/ispp_scan --update && /usr/local/ispprotect/ispp_scan --path=/var/www [email protected] --non-interactive --scan-key=AAA-BBB-CCC-DDD
```

Replace "[[email protected]](https://www.howtoforge.com/cdn-cgi/l/email-protection)" with your email address, the scan report is send to this address. Then exchange "AAA-BBB-CCC-DDD" with your license key. You can get a license key [here](http://ispprotect.com/).

![](https://www.howtoforge.com/images/pdficon_small.png) [view as pdf](https://www.howtoforge.com/subscription/) | ![](https://www.howtoforge.com/images/print.gif) [print](https://www.howtoforge.com/subscription/)

**Share this page:**
