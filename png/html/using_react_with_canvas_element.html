<!DOCTYPE html><html><head><title>Using React with canvas element</title></head><body>
<h1>Using React with canvas element</h1><p><a href="https://medium.com/@lavrton/using-react-with-html5-canvas-871d07d8d753#.4eqd9dxn5" target="_new">Original URL</a></p>
<p><blockquote>We have React that helps us to work with massive mutable DOM in a nice immutable functional style. That is awesome.But I would like to describe a way of using React that helps you to work with&hellip;</blockquote></p>
<div score="17.5"><section name="ca77" class=" section--body section--first" score="41.25"><div class="section-content" score="33.75"><div class="section-inner u-sizeFullWidth" score="1.25"><figure name="4680" id="4680" class="graf--figure graf--layoutFillWidth graf--first" score="-12.5"><div class="aspectRatioPlaceholder is-locked" score="6.25"><img class="graf-image" src="https://cdn-images-2.medium.com/max/2000/1*SdXg4o3AfvEbpO4nLNlo2g.png"></div></figure></div><div class="section-inner layoutSingleColumn"><p name="1a06" id="1a06" class="graf--p graf-after--h3">We have React that helps us to work with massive mutable DOM in a nice immutable functional style. That is awesome.</p><p name="a5c6" id="a5c6" class="graf--p graf-after--p graf--last">But I would like to describe a way of using React that helps you to work with mutable object representation of &#x201C;immutable&#x201D; &lt;canvas&gt; element. WTF? Yes, it sounds strange. But it works really well.</p></div></div></section><section name="3106" class=" section--body section--last" score="41.25"><div class="section-content" score="32.5"><div class="section-inner layoutSingleColumn" score="1.25"><p name="9ad9" id="9ad9" class="graf--p graf-after--h3">I am using &lt;canvas&gt; element a lot. I made several complex applications which use &lt;canvas&gt; as a main view component. Vanilla canvas without any frameworks/libraries can be really difficult for complex applications. So I started to use canvas frameworks a lot. Now I maintain <a href="http://konvajs.github.io/" class="markup--anchor markup--p-anchor" rel="nofollow">Konva 2d canvas Framework</a>.</p><p name="c9dd" id="c9dd" class="graf--p graf-after--p">Konva helps a lot, but still now not so good, as I wanted. Also I started to use React in my applications and I really like to use it. So I was thinking how can I use React for drawing graphics on canvas.</p><p name="6c8f" id="6c8f" class="graf--p graf-after--h3">It is very easy to access &lt;canvas&gt; context in React component and draw any graphics:</p><pre name="b7b7" id="b7b7" class="graf--pre graf-after--p">class CanvasComponent extends React.Component {<br> componentDidMount() {<br> this.updateCanvas();<br> }<br> updateCanvas() {<br> const ctx = this.refs.canvas.getContext('2d');<br> ctx.fillRect(0,0, 100, 100);<br> }<br> render() {<br> return (<br> &lt;canvas ref="canvas" width={300} height={300}/&gt;<br> );<br> }<br>}</pre><pre name="882f" id="882f" class="graf--pre graf-after--pre">ReactDOM.render(&lt;CanvasComponent/&gt;, document.getElementById('container'));</pre><p name="f272" id="f272" class="graf--p graf-after--pre">Demo: <a href="http://jsbin.com/xituko/edit?js,output" class="markup--anchor markup--p-anchor" rel="nofollow">http://jsbin.com/xituko/edit?js,output</a></p><p name="d8d8" id="d8d8" class="graf--p graf-after--p">It works nice for trivial examples. But for complex applications this approach is not so good because we can not use full power of reusable React components.</p><pre name="27d1" id="27d1" class="graf--pre graf-after--p">// &#x201C;reusable component&#x201D;<br>function rect(props) {<br> const {ctx, x, y, width, height} = props;<br> ctx.fillRect(x, y, width, height);<br>}</pre><pre name="1fc8" id="1fc8" class="graf--pre graf-after--pre">class CanvasComponent extends React.Component {<br> componentDidMount() {<br> this.updateCanvas();<br> }<br> componentDidUpdate() {<br> this.updateCanvas();<br> }<br> updateCanvas() {<br> const ctx = this.refs.canvas.getContext('2d');<br> ctx.clearRect(0,0, 300, 300);<br> // draw children &#x201C;components&#x201D;<br> rect({ctx, x: 10, y: 10, width: 50, height: 50});<br> rect({ctx, x: 110, y: 110, width: 50, height: 50});<br> }<br> render() {<br> return (<br> &lt;canvas ref="canvas" width={300} height={300}/&gt;<br> );<br> }<br>}</pre><pre name="7f48" id="7f48" class="graf--pre graf-after--pre">ReactDOM.render(&lt;CanvasComponent/&gt;, document.getElementById('container'));</pre><p name="76e6" id="76e6" class="graf--p graf-after--pre">And what about React&#x2019;s lifecycle methods (like <em class="markup--em markup--p-em">shouldComponentUpdate etc</em>) and &#x201C;all representation inside render function&#x201D;?</p><p name="6ceb" id="6ceb" class="graf--p graf-after--h3">I really like React approach for building apps. So I made react binding to Konva objects. And now I can draw canvas stage with different graphic shapes and use it in my React application.</p><pre name="6569" id="6569" class="graf--pre graf-after--p">npm install react konva react-konva --save</pre><p name="cc75" id="cc75" class="graf--p graf-after--pre">Then</p><pre name="463c" id="463c" class="graf--pre graf-after--p">import React from 'react';<br>import ReactDOM from 'react-dom';<br>import {Layer, Rect, Stage, Group} from &#x2018;react-konva&#x2019;;<br> <br>class MyRect extends React.Component {<br> constructor(...args) {<br> super(...args);<br> this.state = {<br> color: 'green'<br> };<br> this.handleClick = this.handleClick.bind(this);<br> }<br> handleClick() {<br> this.setState({<br> color: Konva.Util.getRandomColor()<br> });<br> }<br> render() {<br> return (<br> &lt;Rect<br> x={10} y={10} width={50} height={50}<br> fill={this.state.color}<br> shadowBlur={10}<br> onClick={this.handleClick}<br> /&gt;<br> );<br> }<br>}</pre><pre name="f3e2" id="f3e2" class="graf--pre graf-after--pre">function App() {<br> return (<br> &lt;Stage width={700} height={700}&gt;<br> &lt;Layer&gt;<br> &lt;MyRect/&gt;<br> &lt;/Layer&gt;<br> &lt;/Stage&gt;<br> );<br>}</pre><pre name="3ae4" id="3ae4" class="graf--pre graf-after--pre">ReactDOM.render(&lt;App/&gt;, document.getElementById('container'));</pre><p name="272a" id="272a" class="graf--p graf-after--pre">Demo: <a href="http://jsbin.com/camene/5/edit?html,js,output" class="markup--anchor markup--p-anchor" rel="nofollow">http://jsbin.com/camene/5/edit?html,js,output</a></p><p name="8a7e" id="8a7e" class="graf--p graf-after--p">Thanks <a href="https://github.com/reactjs/react-art" class="markup--anchor markup--p-anchor" rel="nofollow">https://github.com/reactjs/react-art</a> for providing good examples of custom React components.</p><p name="31d9" id="31d9" class="graf--p graf-after--h4"><a href="https://github.com/Flipboard/react-canvas" class="markup--anchor markup--p-anchor" rel="nofollow">react-canvas</a> is a completely different react plugin. It allows you to draw DOM-like objects (images, texts) on canvas element in very performant way. It is NOT about drawing graphics, but <strong class="markup--strong markup--p-strong">react-konva</strong> is exactly for drawing complex graphics on &lt;canvas&gt; element from React.</p><p name="fbe9" id="fbe9" class="graf--p graf-after--h4"><a href="https://github.com/reactjs/react-art" class="markup--anchor markup--p-anchor" rel="nofollow">react-art</a> allows you to draw graphics on a page. It also supports SVG for output. But it has no support of events of shapes.</p><p name="17a0" id="17a0" class="graf--p graf-after--h4">Performance is one of the main buzz word in react hype.</p><p name="a957" id="a957" class="graf--p graf-after--p">I made this plugin not for performance reasons. Using vanilla &lt;canvas&gt; should be more performant because while using react-konva you have Konva framework on top of &lt;canvas&gt; and React on top of Konva. But I made this plugin to fight with application complexity. Konva helps here a lot (especially when you need events for objects on canvas, like &#x201C;click&#x201D; on shape, it is really hard to do with vanilla canvas). But React helps here much more as it provides very good structure for your codebase and data flow.</p><figure name="3cb3" id="3cb3" class="graf--figure graf-after--h3" score="-12.5"><div class="aspectRatioPlaceholder is-locked" score="6.25"><img class="graf-image" src="https://cdn-images-2.medium.com/max/800/1*5ZIw0SFvYvzAI56VFKMHQQ.png"></div><figcaption class="imageCaption">react-konva logo</figcaption></figure><p name="f2bf" id="f2bf" class="graf--p graf-after--figure"><em class="markup--em markup--p-em">react-konva</em> works on top of <em class="markup--em markup--p-em">Konva</em> so it has support for all core shapes: Circle, Rect, Ellipse, Line, Sprite, Image, Text, TextPath, Star, Ring, Arc, Label, SVG Path, RegularPolygon, Arrow and you can create your own custom shapes. Also you can use build in drag&amp;drop support, tweening, animations, filters, caching system, desktop and mobile events (mouseenter, click, dblclick, dragstart, dragmove, dragend, tap, dbltap, etc) and much more.</p><pre name="d196" id="d196" class="graf--pre graf-after--h4">// custom shape example<br>function MyShape() {<br> return (<br> &lt;Shape fill=&#x201D;#00D2FF&#x201D; draggable<br> sceneFunc={function (ctx) {<br> ctx.beginPath();<br> ctx.moveTo(20, 50);<br> ctx.lineTo(220, 80);<br> ctx.quadraticCurveTo(150, 100, 260, 170);<br> ctx.closePath();</pre><pre name="15b7" id="15b7" class="graf--pre graf-after--pre"> // Konva specific method<br> ctx.fillStrokeShape(this);<br> }}<br> /&gt;<br> );<br>}</pre><p name="3e47" id="3e47" class="graf--p graf-after--pre">Demo: <a href="http://jsbin.com/gakadi/2/edit?html,js,output" class="markup--anchor markup--p-anchor" rel="nofollow">http://jsbin.com/gakadi/2/edit?html,js,output</a></p><pre name="e986" id="e986" class="graf--pre graf-after--h4">class MyCircle extends React.Component {<br> constructor(&#x2026;args) {<br> super(&#x2026;args);<br> this.state = { isMouseInside: false};<br> this.handleMouseEnter = this.handleMouseEnter.bind(this);<br> this.handleMouseLeave = this.handleMouseLeave.bind(this);<br> }<br> handleMouseEnter() {<br> this.setState({ isMouseInside: true});<br> }<br> handleMouseLeave() {<br> this.setState({ isMouseInside: false});<br> }<br> render() {<br> return (<br> &lt;Circle<br> x={100} y={60} radius={50}<br> fill=&#x201D;yellow&#x201D; stroke=&#x201D;black&#x201D;<br> strokeWidth={this.state.isMouseInside ? 5 : 1}<br> onMouseEnter={this.handleMouseEnter}<br> onMouseLeave={this.handleMouseLeave}<br> /&gt;<br> );<br> }<br>}</pre><p name="dc63" id="dc63" class="graf--p graf-after--pre">Demo: <a href="http://jsbin.com/tekopu/1/edit" class="markup--anchor markup--p-anchor" rel="nofollow">http://jsbin.com/tekopu/1/edit</a></p><p name="13bb" id="13bb" class="graf--p graf-after--h3">Github repo: <a href="https://github.com/lavrton/react-konva" class="markup--anchor markup--p-anchor" rel="nofollow">https://github.com/lavrton/react-konva</a></p><p name="8a40" id="8a40" class="graf--p graf-after--p graf--last">Konva framework: <a href="http://konvajs.github.io/" class="markup--anchor markup--p-anchor" rel="nofollow">http://konvajs.github.io/</a></p></div></div></section></div>
</body></html>
