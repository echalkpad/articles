<!DOCTYPE html><html><head><title>alfateam/rdb</title></head><body>
<h1>alfateam/rdb</h1><p><a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md" target="_new">Original URL</a></p>
<p><blockquote>All examples below are found at npmjs.org/package/rdb-demo. Documentation and examples Connecting connect to postgres connect to mySql pool size end pool end all pools</blockquote></p>
<div><article class="markdown-body entry-content"><p>All examples below are found at <a href="https://npmjs.org/package/rdb-demo">npmjs.org/package/rdb-demo</a>. </p>

<h2><a id="user-content-documentation-and-examples" class="anchor" href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#documentation-and-examples"><svg class="octicon octicon-link" height="16" width="16"><path></path></svg></a><em>Documentation and examples</em></h2>

<p><strong>Connecting</strong><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_connecttopostgres">connect to postgres</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_connecttomysql">connect to mySql</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_poolsize">pool size</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_endpool">end pool</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_endallpools">end all pools</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_logging">logging</a><br>
<strong>Basic querying</strong><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_getbyid">getById</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_trygetbyid">tryGetById</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_trygetfirst">tryGetFirst</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_join">join</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_hasmany">hasMany</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_hasone">hasOne</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_compositekeys">composite keys</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_getbyideager">getById eagerly</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_trygetfirsteager">tryGetFirst eagerly</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_todto">toDto</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_todtowithstrategy">toDto with strategy</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_todtowithorderby">toDto with orderBy</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_todtowithorderbydesc">toDto with orderBy descending</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_serializable">toDto ignoring columns</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_tojson">toJSON</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_tojsonwithstrategy">toJSON with strategy</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_getmany">getMany</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_getmanylazy">getMany lazily</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_getmanyeager">getMany eagerly</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_manytodto">(many)ToDto</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_manytodtowithstrategy">(many)ToDto with strategy</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_manytojson">(many)ToJSON</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_manytojsonwithstrategy">(many)ToJSON with strategy</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_rawsqlquery">Raw SQL query</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_rawsqlquerywithparameters">Raw SQL Query With Parameters</a><br>
<strong>Streaming</strong><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_streameager">streaming rows</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_streamjsoneager">streaming json</a><br>
<strong>Persistence</strong><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_update">update</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_insert">insert</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_delete">delete</a> 
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_cascadedelete">cascade delete</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_bulkdelete">bulk delete</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_bulkcascadedelete">bulk cascade delete</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_defaultvalues">default values</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_conventions">conventions</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_updatejoin">update a join-relation</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_updatehasone">update a hasOne-relation</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_updatehasmany">update a hasMany-relation</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_locking">locking</a> </p>

<p><strong>Filters</strong><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_equal">equal</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_notequal">notEqual</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_not">not</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_lessthan">lessThan</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_lessthanorequal">lessThanOrEqual</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_greaterthan">greaterThan</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_greaterthanorequal">greaterThanOrEqual</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_between">between</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_in">in</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_startswith">startsWith</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_endswith">endsWith</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_contains">contains</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_iequal">iEqual</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_istartswith">iStartsWith</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_iendswith">iEndsWith</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_icontains">iContains</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_exists">exists</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_or">or</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_and">and</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_oralternative">or alternative syntax</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_andalternative">and alternative syntax</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_subfilter">sub filter</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_compositefilter">composite filter</a><br>
<a href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#_rawsqlfilter">raw sql filter</a> </p>

<h2><a id="user-content-contents" class="anchor" href="https://github.com/alfateam/rdb/blob/master/docs/docs.md#contents"><svg class="octicon octicon-link" height="16" width="16"><path></path></svg></a><em>Contents</em></h2>

<p><a name="user-content-_connecttopostgres"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/connect.js">connect to postgres</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);
<span class="pl-c">//will use pool with 10 connections by default</span>
<span class="pl-c">//alternatively: var db = rdb.pg('postgres://postgres:postgres@localhost/test');</span>

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_connecttomysql"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/mySql/connect.js">connect to mySql</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">mySql</span>(<span class="pl-s"><span class="pl-pds">'</span>mysql://root@localhost/rdbDemo?multipleStatements=true<span class="pl-pds">'</span></span>);
<span class="pl-c">//will use pool with 10 connections by default</span>

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_poolsize"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/poolOptions.js">pool size</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> poolOptions <span class="pl-k">=</span> {size<span class="pl-k">:</span> <span class="pl-c1">20</span>};
<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>, poolOptions);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success. Created pool with max 20 connections.<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_endpool"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/endPool.js">end pool</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(<span class="pl-smi">db</span>.<span class="pl-smi">end</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Pool ended.<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_endallpools"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/endAllPools.js">end all pools</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> dbPg <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> dbMySql <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">mySql</span>(<span class="pl-s"><span class="pl-pds">'</span>mysql://root@localhost/rdbDemo?multipleStatements=true<span class="pl-pds">'</span></span>);

<span class="pl-en">connectPg</span>()
 .<span class="pl-en">then</span>(connectMySql)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">end</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);


<span class="pl-k">function</span> <span class="pl-en">connectPg</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">dbPg</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>);
}

<span class="pl-k">function</span> <span class="pl-en">connectMySql</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">dbMySql</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Pools ended.<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">stack</span>);
}
</pre></div>

<p><a name="user-content-_logging"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/logging.js">logging</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);
<span class="pl-smi">rdb</span>.<span class="pl-en">log</span>(<span class="pl-en">console</span>.<span class="pl-smi">log</span>); <span class="pl-c">//will log sql and parameters</span>

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(update)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">update</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Ringo<span class="pl-pds">'</span></span>; 
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_getbyid"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/getById.js">getById</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cRegdate<span class="pl-pds">'</span></span>).<span class="pl-en">date</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>registeredDate<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cPicture<span class="pl-pds">'</span></span>).<span class="pl-en">binary</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>picture<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cDocument<span class="pl-pds">'</span></span>).<span class="pl-en">json</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>document<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, Balance: %s, Registered Date: %s, Is Active: %s, Picture: %s, , Document: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">registeredDate</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">isActive</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">picture</span>, <span class="pl-c1">JSON</span>.<span class="pl-en">stringify</span>(<span class="pl-smi">customer</span>.<span class="pl-smi">document</span>)];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_trygetbyid"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/tryGetById.js">tryGetById</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cRegdate<span class="pl-pds">'</span></span>).<span class="pl-en">date</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>registeredDate<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cPicture<span class="pl-pds">'</span></span>).<span class="pl-en">binary</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>picture<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cDocument<span class="pl-pds">'</span></span>).<span class="pl-en">json</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>document<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(tryGetById)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">tryGetById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">tryGetById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (customer) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, Balance: %s, Registered Date: %s, Is Active: %s, Picture: %s, , Document: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">registeredDate</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">isActive</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">picture</span>, <span class="pl-c1">JSON</span>.<span class="pl-en">stringify</span>(<span class="pl-smi">customer</span>.<span class="pl-smi">document</span>)];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_trygetfirst"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/tryGetFirst.js">tryGetFirst</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(tryGetFirst)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">tryGetFirst</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">tryGetFirst</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (customer) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);;
 }
 <span class="pl-k">else</span>
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>customer not found<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_join"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/join.js">join</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-a000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s, Customer Id: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>, <span class="pl-smi">order</span>.<span class="pl-smi">customerId</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">customer</span>; <span class="pl-c">//this is a promise</span>
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-k">!</span>customer)
 <span class="pl-k">return</span>;
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_hasmany"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/hasMany.js">hasMany</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printLines)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">lines</span>; <span class="pl-c">//this is a promise</span>
}

<span class="pl-k">function</span> <span class="pl-en">printLines</span>(<span class="pl-smi">lines</span>) {
 <span class="pl-smi">lines</span>.<span class="pl-en">forEach</span>(printLine);

 <span class="pl-k">function</span> <span class="pl-en">printLine</span>(<span class="pl-smi">line</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Line Id: %s, Order Id: %s, Product: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">line</span>.<span class="pl-c1">id</span>, <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span>, <span class="pl-smi">line</span>.<span class="pl-c1">product</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 } 
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_hasone"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/hasOne.js">hasOne</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printDeliveryAddress)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">deliveryAddress</span>; <span class="pl-c">//this is a promise</span>
}

<span class="pl-k">function</span> <span class="pl-en">printDeliveryAddress</span>(<span class="pl-smi">address</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>DeliveryAddress Id: %s, Order Id: %s, %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">address</span>.<span class="pl-c1">id</span>, <span class="pl-smi">address</span>.<span class="pl-smi">orderId</span>, <span class="pl-smi">address</span>.<span class="pl-c1">name</span>, <span class="pl-smi">address</span>.<span class="pl-smi">street</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_compositekeys"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/compositeKeys.js">composite keys</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_compositeOrder<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_compositeOrderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oCompanyId<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>companyId<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lCompanyId<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>companyId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lLineNo<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lineNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lCompanyId<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>lOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printLines)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">var</span> companyId <span class="pl-k">=</span> <span class="pl-c1">1</span>,
 orderId <span class="pl-k">=</span> <span class="pl-c1">1001</span>;
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(companyId, orderId);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Company Id: %s, Order No: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">order</span>.<span class="pl-smi">companyId</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>)
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">lines</span>; <span class="pl-c">//this is a promise</span>
}

<span class="pl-k">function</span> <span class="pl-en">printLines</span>(<span class="pl-smi">lines</span>) {
 <span class="pl-smi">lines</span>.<span class="pl-en">forEach</span>(printLine);

 <span class="pl-k">function</span> <span class="pl-en">printLine</span>(<span class="pl-smi">line</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Company Id: %s, Order No: %s, Line No: %s, Product: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">line</span>.<span class="pl-smi">companyId</span>, <span class="pl-smi">line</span>.<span class="pl-smi">orderNo</span>, <span class="pl-smi">line</span>.<span class="pl-smi">lineNo</span>, <span class="pl-smi">line</span>.<span class="pl-c1">product</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 } 
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_getbyideager"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/getByIdEager.js">getById eagerly</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrderWithCustomer)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrderWithCustomer</span>() {
 <span class="pl-k">var</span> fetchingStrategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>}; <span class="pl-c">//alternatively: {customer : {}} </span>
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-a000-0000-0000-000000000000<span class="pl-pds">'</span></span>, fetchingStrategy);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s, Customer Id: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>, <span class="pl-smi">order</span>.<span class="pl-smi">customerId</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">customer</span>; <span class="pl-c">//this is a promise</span>
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-k">!</span>customer)
 <span class="pl-k">return</span>;
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_trygetfirsteager"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/tryGetFirstEager.js">tryGetFirst eagerly</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(tryGetFirstOrderWithCustomer)
 .<span class="pl-en">then</span>(printOrder)
 .<span class="pl-en">then</span>(printCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">tryGetFirstOrderWithCustomer</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-smi">customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">tryGetFirst</span>(filter, strategy);
}

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">if</span> (<span class="pl-k">!</span>order) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>order not found<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span>;
 }
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s, Customer Id: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>, <span class="pl-smi">order</span>.<span class="pl-smi">customerId</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">customer</span>;
}

<span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-k">!</span>customer) 
 <span class="pl-k">return</span>;
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_todto"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toDto.js">toDto</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toDto</span>(<span class="pl-c">/*strategy*/</span>);
 <span class="pl-c">//default strategy, expand all hasOne and hasMany relations</span>
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(dto);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_todtowithstrategy"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toDtoWithStrategy.js">toDto with strategy</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>, lines <span class="pl-k">:</span> <span class="pl-c1">null</span>, deliveryAddress <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toDto</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(dto);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_todtowithorderby"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toDtoWithOrderBy.js">toDto with orderBy</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {
 lines<span class="pl-k">:</span> {
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>] 
 <span class="pl-c">//alternative: orderBy: ['product asc']</span>
 }
 };
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toDto</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(dto);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_todtowithorderbydesc"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toDtoWithOrderByDesc.js">toDto with orderBy descending</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {
 lines<span class="pl-k">:</span> {
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>product desc<span class="pl-pds">'</span></span>] 
 }
 };
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toDto</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(dto);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_serializable"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/serializable.js">toDto ignoring columns</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> User <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_User<span class="pl-pds">'</span></span>);
<span class="pl-smi">User</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>uId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">User</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>uUserId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>userId<span class="pl-pds">'</span></span>);
<span class="pl-smi">User</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>uPassword<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>).<span class="pl-en">serializable</span>(<span class="pl-c1">false</span>);
<span class="pl-smi">User</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>uEmail<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getUser)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getUser</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">User</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>87654400-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">user</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">user</span>.<span class="pl-en">toDto</span>().<span class="pl-en">then</span>(<span class="pl-en">console</span>.<span class="pl-smi">log</span>);
 <span class="pl-c">//will print all properties except password</span>
 <span class="pl-c">//because it is not serializable</span>
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_tojson"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toJSON.js">toJSON</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toJSON</span>(<span class="pl-c">/*strategy*/</span>);
 <span class="pl-c">//default strategy, expand all hasOne and hasMany relations</span>
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_tojsonwithstrategy"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/toJSONWithStrategy.js">toJSON with strategy</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrder)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrder</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>, lines <span class="pl-k">:</span> <span class="pl-c1">null</span>, deliveryAddress <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-en">toJSON</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_getmany"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/getMany.js">getMany</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getAllCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getAllCustomers</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_getmanylazy"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/getManyLazy.js">getMany lazily</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>),
 promise <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>promise<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getAllOrders)
 .<span class="pl-en">then</span>(printOrders)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getAllOrders</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">printOrders</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">var</span> printAllLines <span class="pl-k">=</span> [];
 <span class="pl-smi">orders</span>.<span class="pl-en">forEach</span>(printOrder);

 <span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-smi">printAllLines</span>.<span class="pl-c1">push</span>(<span class="pl-smi">order</span>.<span class="pl-smi">lines</span>.<span class="pl-en">then</span>(printLines));
 }
 <span class="pl-k">return</span> <span class="pl-smi">promise</span>.<span class="pl-c1">all</span>(printAllLines);
}

<span class="pl-k">function</span> <span class="pl-en">printLines</span>(<span class="pl-smi">lines</span>) {
 <span class="pl-smi">lines</span>.<span class="pl-en">forEach</span>(printLine);

 <span class="pl-k">function</span> <span class="pl-en">printLine</span>(<span class="pl-smi">line</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Line Id: %s, Order Id: %s, Product: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">line</span>.<span class="pl-c1">id</span>, <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span>, <span class="pl-smi">line</span>.<span class="pl-c1">product</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 } 
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_getmanyeager"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/getManyEager.js">getMany eager</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>),
 promise <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>promise<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getAllOrders)
 .<span class="pl-en">then</span>(printOrders)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getAllOrders</span>() {
 <span class="pl-k">var</span> emptyFilter;
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {lines <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>(emptyFilter, strategy);
}

<span class="pl-k">function</span> <span class="pl-en">printOrders</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">var</span> printAllLines <span class="pl-k">=</span> [];
 <span class="pl-smi">orders</span>.<span class="pl-en">forEach</span>(printOrder);

 <span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 <span class="pl-smi">printAllLines</span>.<span class="pl-c1">push</span>(<span class="pl-smi">order</span>.<span class="pl-smi">lines</span>.<span class="pl-en">then</span>(printLines));
 }
 <span class="pl-k">return</span> <span class="pl-smi">promise</span>.<span class="pl-c1">all</span>(printAllLines);
}

<span class="pl-k">function</span> <span class="pl-en">printLines</span>(<span class="pl-smi">lines</span>) {
 <span class="pl-smi">lines</span>.<span class="pl-en">forEach</span>(printLine);

 <span class="pl-k">function</span> <span class="pl-en">printLine</span>(<span class="pl-smi">line</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Line Id: %s, Order Id: %s, Product: %s<span class="pl-pds">'</span></span>; 
 <span class="pl-k">var</span> args <span class="pl-k">=</span> [format, <span class="pl-smi">line</span>.<span class="pl-c1">id</span>, <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span>, <span class="pl-smi">line</span>.<span class="pl-c1">product</span>];
 <span class="pl-en">console</span>.<span class="pl-smi">log</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>,args);
 } 
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_manytodto"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/manyToDto.js">(many)ToDto</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>),
 inspect <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>).<span class="pl-smi">inspect</span>;

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toDto</span>(<span class="pl-c">/*strategy*/</span>);
 <span class="pl-c">//default strategy, expand all hasOne and hasMany relations</span>
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">inspect</span>(dto,<span class="pl-c1">false</span>,<span class="pl-c1">10</span>));
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_manytodtowithstrategy"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/manyToDtoWithStrategy.js">(many)ToDto with strategy</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>),
 inspect <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>).<span class="pl-smi">inspect</span>;

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toDto)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">toDto</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>, lines <span class="pl-k">:</span> <span class="pl-c1">null</span>, deliveryAddress <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toDto</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">dto</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">inspect</span>(dto,<span class="pl-c1">false</span>,<span class="pl-c1">10</span>));
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_manytojson"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/manyToJSON.js">(many)ToJSON</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toJSON</span>(<span class="pl-c">/*strategy*/</span>);
 <span class="pl-c">//default strategy, expand all hasOne and hasMany relations</span>
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_manytojsonwithstrategy"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/manyToJSONWithStrategy.js">(many)ToJSON with strategy</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> order_customer_relation <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>();
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer <span class="pl-k">:</span> <span class="pl-c1">null</span>, lines <span class="pl-k">:</span> <span class="pl-c1">null</span>, deliveryAddress <span class="pl-k">:</span> <span class="pl-c1">null</span>};
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toJSON</span>(strategy);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_rawsqlquery"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/rawSqlQuery.js">Raw SQL Query</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getUniqueCustomerIds)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getUniqueCustomerIds</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">rdb</span>.<span class="pl-en">query</span>(<span class="pl-s"><span class="pl-pds">'</span>SELECT DISTINCT oCustomerId AS "customerId" FROM _order<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">rows</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(rows);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_rawsqlquerywithparameters"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/rawSqlQueryWithParameters.js">Raw SQL Query With Parameters</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrderNos)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrderNos</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">rdb</span>.<span class="pl-en">query</span>({
 sql<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>SELECT oOrderNo AS "orderNo" FROM _order WHERE oOrderNo LIKE ?<span class="pl-pds">'</span></span>,
 parameters<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>%04<span class="pl-pds">'</span></span>]
 });
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">rows</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(rows);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_streameager"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/streamEager.js">streaming rows</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> emptyFilter;
<span class="pl-k">var</span> strategy <span class="pl-k">=</span> {
 lines<span class="pl-k">:</span> {
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>]
 },
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>],
 limit<span class="pl-k">:</span> <span class="pl-c1">5</span>,
};

<span class="pl-smi">Order</span>.<span class="pl-en">createReadStream</span>(db, emptyFilter, strategy).<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, printOrder);

<span class="pl-k">function</span> <span class="pl-en">printOrder</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Order Id: %s, Order No: %s<span class="pl-pds">'</span></span>;
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(format, <span class="pl-smi">order</span>.<span class="pl-c1">id</span>, <span class="pl-smi">order</span>.<span class="pl-smi">orderNo</span>);
 <span class="pl-smi">order</span>.<span class="pl-smi">lines</span>.<span class="pl-en">forEach</span>(printLine);
}

<span class="pl-k">function</span> <span class="pl-en">printLine</span>(<span class="pl-smi">line</span>) {
 <span class="pl-k">var</span> format <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Line Id: %s, Order Id: %s, Product: %s<span class="pl-pds">'</span></span>;
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(format, <span class="pl-smi">line</span>.<span class="pl-c1">id</span>, <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span>, <span class="pl-smi">line</span>.<span class="pl-c1">product</span>);
}</pre></div>

<p><a name="user-content-_streamjsoneager"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/streamJSONEager.js">streaming json</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> emptyFilter;
<span class="pl-k">var</span> strategy <span class="pl-k">=</span> {
 lines<span class="pl-k">:</span> {
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>]
 },
 orderBy<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>],
 limit<span class="pl-k">:</span> <span class="pl-c1">5</span>,
};

<span class="pl-smi">Order</span>.<span class="pl-en">createJSONReadStream</span>(db, emptyFilter, strategy).<span class="pl-en">pipe</span>(<span class="pl-c1">process</span>.<span class="pl-smi">stdout</span>);</pre></div>

<p><a name="user-content-_update"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/update.js">update</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(update)
 .<span class="pl-en">then</span>(getById) <span class="pl-c">//will use cache</span>
 .<span class="pl-en">then</span>(verifyUpdated)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">update</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Ringo<span class="pl-pds">'</span></span>; 
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdated</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>Ringo<span class="pl-pds">'</span></span>)
 <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>this will not happen<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_insert"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/insert.js">insert</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(insert)
 .<span class="pl-en">then</span>(getById) <span class="pl-c">//will use cache</span>
 .<span class="pl-en">then</span>(verifyInserted)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">insert</span>() {
 <span class="pl-k">var</span> customer <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>abcdef00-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>)
 <span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Paul<span class="pl-pds">'</span></span>;
}

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>abcdef00-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">verifyInserted</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>Paul<span class="pl-pds">'</span></span>)
 <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>this will not happen<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_delete"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/delete.js">delete</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cRegdate<span class="pl-pds">'</span></span>).<span class="pl-en">date</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>registeredDate<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cPicture<span class="pl-pds">'</span></span>).<span class="pl-en">binary</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>picture<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(deleteCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() { 
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>87654321-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">deleteCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-smi">customer</span>.<span class="pl-en">delete</span>();
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">stack</span>);
}</pre></div>

<p><a name="user-content-_cascadedelete"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/cascadeDelete.js">cascadeDelete</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> orderToCustomer <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">hasMany</span>(orderToCustomer).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orders<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(deleteCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>87654399-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">deleteCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-smi">customer</span>.<span class="pl-en">cascadeDelete</span>();
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">stack</span>);
}</pre></div>

<p><a name="user-content-_bulkdelete"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/bulkDelete.js">bulk delete</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cRegdate<span class="pl-pds">'</span></span>).<span class="pl-en">date</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>registeredDate<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cPicture<span class="pl-pds">'</span></span>).<span class="pl-en">binary</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>picture<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(deleteCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">deleteCustomer</span>() { 
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">id</span>.<span class="pl-en">eq</span>(<span class="pl-s"><span class="pl-pds">'</span>87654321-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">delete</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">stack</span>);
}</pre></div>

<p><a name="user-content-_cascadedelete"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/bulkCascadeDelete.js">bulk cascadeDelete</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> orderToCustomer <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">hasMany</span>(orderToCustomer).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orders<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(deleteCustomer)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">deleteCustomer</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">id</span>.<span class="pl-en">eq</span>(<span class="pl-s"><span class="pl-pds">'</span>87654399-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
 <span class="pl-smi">Customer</span>.<span class="pl-en">cascadeDelete</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">stack</span>);
}</pre></div>

<p><a name="user-content-_defaultvalues"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/defaultValues.js">default values</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> buf <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Buffer</span>(<span class="pl-c1">10</span>);
<span class="pl-smi">buf</span>.<span class="pl-c1">write</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\u</span>00bd + <span class="pl-cce">\u</span>00bc = <span class="pl-cce">\u</span>00be<span class="pl-pds">'</span></span>, <span class="pl-c1">0</span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-c">/*unless overridden, numeric is default 0, </span>
<span class="pl-c">string is default null, </span>
<span class="pl-c">guid is default null,</span>
<span class="pl-c">date is default null,</span>
<span class="pl-c">binary is default null,</span>
<span class="pl-c">boolean is default false,</span>
<span class="pl-c">json is default null</span>
<span class="pl-c">*/</span> 

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(<span class="pl-c1">null</span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(<span class="pl-s"><span class="pl-pds">'</span>default name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(<span class="pl-c1">2000</span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cRegdate<span class="pl-pds">'</span></span>).<span class="pl-en">date</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>registeredDate<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(<span class="pl-k">new</span> <span class="pl-en">Date</span>());
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(<span class="pl-c1">true</span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cPicture<span class="pl-pds">'</span></span>).<span class="pl-en">binary</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>picture<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>(buf);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cDocument<span class="pl-pds">'</span></span>).<span class="pl-en">json</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>document<span class="pl-pds">'</span></span>).<span class="pl-en">default</span>({foo<span class="pl-k">:</span> <span class="pl-c1">true</span>});

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(insert)
 .<span class="pl-en">then</span>(print) 
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">insert</span>() {
 <span class="pl-k">var</span> customer <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>abcdef02-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>)
 <span class="pl-k">return</span> <span class="pl-smi">customer</span>.<span class="pl-en">toJSON</span>();
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_conventions"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/conventions.js">conventions</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>(); <span class="pl-c">//property name will also be cId</span>
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>(); <span class="pl-c">//property name will also be cName</span>

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(insert)
 .<span class="pl-en">then</span>(print) 
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">insert</span>() {
 <span class="pl-k">var</span> customer <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>abcdef01-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>)
 <span class="pl-smi">customer</span>.<span class="pl-smi">cName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Paul<span class="pl-pds">'</span></span>;
 <span class="pl-k">return</span> <span class="pl-smi">customer</span>.<span class="pl-en">toJSON</span>();
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_updatejoin"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/updateJoin.js">update a join-relation</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(update)
 .<span class="pl-en">then</span>(verifyUpdated)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>b0000000-b000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">update</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">var</span> yokoId <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>12345678-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>;
 <span class="pl-smi">order</span>.<span class="pl-smi">customerId</span> <span class="pl-k">=</span> yokoId;
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">customer</span>; 
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdated</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-k">if</span> (<span class="pl-smi">customer</span>.<span class="pl-c1">name</span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>Yoko<span class="pl-pds">'</span></span>)
 <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>this will not happen<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_updatehasone"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/updateHasOne.js">update a hasOne-relation</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">hasone</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(insertDeliveryAddress)
 .<span class="pl-en">then</span>(verifyUpdated)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">insertDeliveryAddress</span>() {
 <span class="pl-k">var</span> address <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>eeeeeeee-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
 <span class="pl-smi">address</span>.<span class="pl-smi">orderId</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>a0000000-a000-0000-0000-000000000000<span class="pl-pds">'</span></span>;
 <span class="pl-smi">address</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Sgt. Pepper<span class="pl-pds">'</span></span>;
 <span class="pl-smi">address</span>.<span class="pl-smi">street</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>L18 Penny Lane<span class="pl-pds">'</span></span>;
 <span class="pl-k">return</span> <span class="pl-smi">address</span>.<span class="pl-smi">order</span>;
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdated</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">deliveryAddress</span>.<span class="pl-en">then</span>(verifyUpdatedAddress);;
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdatedAddress</span>(<span class="pl-smi">deliveryAddress</span>) {
 <span class="pl-k">if</span> (<span class="pl-smi">deliveryAddress</span>.<span class="pl-smi">street</span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">'</span>L18 Penny Lane<span class="pl-pds">'</span></span>)
 <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>this will not happen<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_updatehasmany"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/updateHasMany.js">update a hasMany-relation</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> orderIdWithNoLines <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>c0000000-c000-0000-0000-000000000000<span class="pl-pds">'</span></span>;

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(insertOrderLine1)
 .<span class="pl-en">then</span>(insertOrderLine2)
 .<span class="pl-en">then</span>(verifyUpdated)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">insertOrderLine1</span>() {
 <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>eeeeeeee-0001-0000-0000-000000000000<span class="pl-pds">'</span></span>);
 <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span> <span class="pl-k">=</span> orderIdWithNoLines;
 <span class="pl-smi">line</span>.<span class="pl-c1">product</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Roller blades<span class="pl-pds">'</span></span>;
 <span class="pl-k">return</span> <span class="pl-smi">line</span>.<span class="pl-smi">order</span>;
}

<span class="pl-k">function</span> <span class="pl-en">insertOrderLine2</span>() {
 <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-en">insert</span>(<span class="pl-s"><span class="pl-pds">'</span>eeeeeeee-0002-0000-0000-000000000000<span class="pl-pds">'</span></span>);
 <span class="pl-smi">line</span>.<span class="pl-smi">orderId</span> <span class="pl-k">=</span> orderIdWithNoLines;
 <span class="pl-smi">line</span>.<span class="pl-c1">product</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Helmet<span class="pl-pds">'</span></span>;
 <span class="pl-k">return</span> <span class="pl-smi">line</span>.<span class="pl-smi">order</span>;
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdated</span>(<span class="pl-smi">order</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">order</span>.<span class="pl-smi">lines</span>.<span class="pl-en">then</span>(verifyUpdatedLines);
}

<span class="pl-k">function</span> <span class="pl-en">verifyUpdatedLines</span>(<span class="pl-smi">lines</span>) {
 <span class="pl-k">if</span> (<span class="pl-smi">lines</span>.<span class="pl-c1">length</span> <span class="pl-k">!==</span> <span class="pl-c1">2</span>)
 <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>this will not happen<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_locking"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/exclusive.js">locking</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> promise <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>promise<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">exclusive</span>();

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-en">showBalance</span>()
 .<span class="pl-en">then</span>(updateConcurrently)
 .<span class="pl-en">then</span>(showBalance)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">showBalance</span>() {
 <span class="pl-k">return</span> <span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(printBalance)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>);

 <span class="pl-k">function</span> <span class="pl-en">printBalance</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Balance: <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>)
 }
}

<span class="pl-k">function</span> <span class="pl-en">updateConcurrently</span>() {
 <span class="pl-k">var</span> concurrent1 <span class="pl-k">=</span> <span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(increaseBalance)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>);

 <span class="pl-k">var</span> concurrent2 <span class="pl-k">=</span> <span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getById)
 .<span class="pl-en">then</span>(increaseBalance)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>);
 <span class="pl-k">return</span> <span class="pl-smi">promise</span>.<span class="pl-c1">all</span>([concurrent1, concurrent2]);
}

<span class="pl-k">function</span> <span class="pl-en">getById</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>....................<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getById</span>(<span class="pl-s"><span class="pl-pds">'</span>a0000000-0000-0000-0000-000000000000<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">increaseBalance</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span> <span class="pl-k">+=</span> <span class="pl-c1">100</span>;
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_equal"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/equal.js">equal</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-c">//same as Customer.name.eq('John'); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_notequal"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/notEqual.js">notEqual</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">notEqual</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-c">//same as Customer.name.ne('John'); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_not"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/not.js">not</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>).<span class="pl-en">not</span>();
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_lessthan"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/lessThan.js">lessThan</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">lessThan</span>(<span class="pl-c1">5000</span>);
 <span class="pl-c">//same as Customer.balance.lt(5000); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, balance : %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_lessthanorequal"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/lessThanOrEqual.js">lessThanOrEqual</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">lessThanOrEqual</span>(<span class="pl-c1">8123</span>);
 <span class="pl-c">//same as Customer.balance.le(8123); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, balance : %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_greaterthan"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/greaterThan.js">greaterThan</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">greaterThan</span>(<span class="pl-c1">5000</span>);
 <span class="pl-c">//same as Customer.balance.gt(5000); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, balance : %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_greaterthanorequal"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/greaterThanOrEqual.js">greaterThanOrEqual</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">greaterThanOrEqual</span>(<span class="pl-c1">8123</span>);
 <span class="pl-c">//same as Customer.balance.ge(8123); </span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, balance : %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_between"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/between.js">between</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">between</span>(<span class="pl-c1">3000</span>, <span class="pl-c1">8123</span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s, balance : %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>, <span class="pl-smi">customer</span>.<span class="pl-smi">balance</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>



<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">in</span>([<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Yoko<span class="pl-pds">'</span></span>]);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_startswith"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/startsWith.js">startsWith</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">startsWith</span>(<span class="pl-s"><span class="pl-pds">'</span>Jo<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_endswith"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/endsWith.js">endsWith</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">endsWith</span>(<span class="pl-s"><span class="pl-pds">'</span>nny<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_contains"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/contains.js">contains</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">contains</span>(<span class="pl-s"><span class="pl-pds">'</span>ohn<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_contains"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/contains.js">contains</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">contains</span>(<span class="pl-s"><span class="pl-pds">'</span>ohn<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_iequal"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/iEqual.js">iEqual (postgres only)</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">iEqual</span>(<span class="pl-s"><span class="pl-pds">'</span>jOhN<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_istartswith"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/iStartsWith.js">iStartsWith (postgres only)</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">iStartsWith</span>(<span class="pl-s"><span class="pl-pds">'</span>jo<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_iendswith"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/iEndsWith.js">iEndsWith (postgres only)</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">iEndsWith</span>(<span class="pl-s"><span class="pl-pds">'</span>nNy<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_icontains"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/iContains.js">iContains (postgres only)</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">iContains</span>(<span class="pl-s"><span class="pl-pds">'</span>oHn<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_exists"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/exists.js">exists</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-smi">deliveryAddress</span>.<span class="pl-en">exists</span>();
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toJSON</span>();
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>



<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> john <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> yoko <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>Yoko<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">john</span>.<span class="pl-en">or</span>(yoko);

 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_and"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/and.js">and</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> isActive <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">isActive</span>.<span class="pl-en">equal</span>(<span class="pl-c1">true</span>);
 <span class="pl-k">var</span> highBalance <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">greaterThan</span>(<span class="pl-c1">8000</span>);
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">isActive</span>.<span class="pl-en">and</span>(highBalance);
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_oralternative"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/orAlternative.js">or alternative syntax</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> john <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>John<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> yoko <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-c1">name</span>.<span class="pl-en">equal</span>(<span class="pl-s"><span class="pl-pds">'</span>Yoko<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-smi">filter</span>.<span class="pl-en">or</span>(john).<span class="pl-en">or</span>(yoko);
 <span class="pl-c">//alternatively rdb.filter.and(john).or(yoko);</span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_andalternative"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/andAlternative.js">and alternative syntax</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getFilteredCustomers)
 .<span class="pl-en">then</span>(printCustomers)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getFilteredCustomers</span>() {
 <span class="pl-k">var</span> isActive <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">isActive</span>.<span class="pl-en">equal</span>(<span class="pl-c1">true</span>);
 <span class="pl-k">var</span> highBalance <span class="pl-k">=</span> <span class="pl-smi">Customer</span>.<span class="pl-smi">balance</span>.<span class="pl-en">greaterThan</span>(<span class="pl-c1">8000</span>);
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-smi">filter</span>.<span class="pl-en">and</span>(isActive).<span class="pl-en">and</span>(highBalance);
 <span class="pl-c">//alternatively rdb.filter.or(isActive).and(highBalance);</span>
 <span class="pl-k">return</span> <span class="pl-smi">Customer</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printCustomers</span>(<span class="pl-smi">customers</span>) {
 <span class="pl-smi">customers</span>.<span class="pl-en">forEach</span>(printCustomer);

 <span class="pl-k">function</span> <span class="pl-en">printCustomer</span>(<span class="pl-smi">customer</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Customer Id: %s, name: %s<span class="pl-pds">'</span></span>, <span class="pl-smi">customer</span>.<span class="pl-c1">id</span>, <span class="pl-smi">customer</span>.<span class="pl-c1">name</span>);
 }
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_subfilter"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/subFilter.js">sub filter</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> DeliveryAddress <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>dId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">DeliveryAddress</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>dStreet<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>street<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> deliveryAddress_order_relation <span class="pl-k">=</span> <span class="pl-smi">DeliveryAddress</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>dOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasOne</span>(deliveryAddress_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>deliveryAddress<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-smi">deliveryAddress</span>.<span class="pl-smi">street</span>.<span class="pl-en">startsWith</span>(<span class="pl-s"><span class="pl-pds">'</span>Node<span class="pl-pds">'</span></span>);
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toJSON</span>();
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_compositefilter"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/compositeFilter.js">composite filter</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> OrderLine <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_orderLine<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);

<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">numeric</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);

<span class="pl-smi">OrderLine</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>lId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderId<span class="pl-pds">'</span></span>);
<span class="pl-smi">OrderLine</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>lProduct<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>product<span class="pl-pds">'</span></span>);

<span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> line_order_relation <span class="pl-k">=</span> <span class="pl-smi">OrderLine</span>.<span class="pl-c1">join</span>(Order).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>lOrderId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">hasMany</span>(line_order_relation).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>lines<span class="pl-pds">'</span></span>);



<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(toJSON)
 .<span class="pl-en">then</span>(print)
 .<span class="pl-en">then</span>(<span class="pl-smi">rdb</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">rdb</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, onFailed);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">var</span> isActive <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-smi">customer</span>.<span class="pl-smi">isActive</span>.<span class="pl-en">eq</span>(<span class="pl-c1">true</span>);
 <span class="pl-k">var</span> didOrderCar <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-smi">lines</span>.<span class="pl-c1">product</span>.<span class="pl-en">contains</span>(<span class="pl-s"><span class="pl-pds">'</span>car<span class="pl-pds">'</span></span>);
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> <span class="pl-smi">isActive</span>.<span class="pl-en">and</span>(didOrderCar);
 <span class="pl-c">//alternatively rdb.filter.and(isActive).and(didOrderCar);</span>
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">toJSON</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toJSON</span>();
}

<span class="pl-k">function</span> <span class="pl-en">print</span>(<span class="pl-smi">json</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(json);
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Waiting for connection pool to teardown....<span class="pl-pds">'</span></span>);
}

<span class="pl-k">function</span> <span class="pl-en">onFailed</span>(<span class="pl-smi">err</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Rollback<span class="pl-pds">'</span></span>);
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
}</pre></div>

<p><a name="user-content-_rawsqlfilter"></a>
<a href="https://github.com/alfateam/rdb-demo/blob/master/filtering/rawSqlFilter.js">raw sql filter</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> inspect <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>).<span class="pl-smi">inspect</span>;
<span class="pl-k">var</span> rdb <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rdb<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Order <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_order<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>oId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oOrderNo<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orderNo<span class="pl-pds">'</span></span>);
<span class="pl-smi">Order</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customerId<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Customer <span class="pl-k">=</span> <span class="pl-smi">rdb</span>.<span class="pl-en">table</span>(<span class="pl-s"><span class="pl-pds">'</span>_customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">primaryColumn</span>(<span class="pl-s"><span class="pl-pds">'</span>cid<span class="pl-pds">'</span></span>).<span class="pl-en">guid</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cName<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cBalance<span class="pl-pds">'</span></span>).<span class="pl-en">string</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>balance<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">column</span>(<span class="pl-s"><span class="pl-pds">'</span>cIsActive<span class="pl-pds">'</span></span>).<span class="pl-en">boolean</span>().<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>isActive<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> orderCustomerJoin <span class="pl-k">=</span> <span class="pl-smi">Order</span>.<span class="pl-c1">join</span>(Customer).<span class="pl-en">by</span>(<span class="pl-s"><span class="pl-pds">'</span>oCustomerId<span class="pl-pds">'</span></span>).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>customer<span class="pl-pds">'</span></span>);
<span class="pl-smi">Customer</span>.<span class="pl-en">hasMany</span>(orderCustomerJoin).<span class="pl-en">as</span>(<span class="pl-s"><span class="pl-pds">'</span>orders<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> db <span class="pl-k">=</span> <span class="pl-en">rdb</span>(<span class="pl-s"><span class="pl-pds">'</span>postgres://postgres:postgres@localhost/test<span class="pl-pds">'</span></span>);

<span class="pl-smi">db</span>.<span class="pl-en">transaction</span>()
 .<span class="pl-en">then</span>(getOrders)
 .<span class="pl-en">then</span>(printOrders)
 .<span class="pl-en">then</span>(<span class="pl-smi">db</span>.<span class="pl-smi">commit</span>)
 .<span class="pl-en">then</span>(<span class="pl-c1">null</span>, <span class="pl-smi">db</span>.<span class="pl-smi">rollback</span>)
 .<span class="pl-en">then</span>(onOk, <span class="pl-en">console</span>.<span class="pl-smi">log</span>);

<span class="pl-k">function</span> <span class="pl-en">getOrders</span>() {
 <span class="pl-k">var</span> filter <span class="pl-k">=</span> {
 sql<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>exists (select 1 from _customer where _customer.cId = oCustomerId and _customer.cBalance &gt; 3000 and _customer.cName LIKE ?)<span class="pl-pds">'</span></span>,
 parameters<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>%o%<span class="pl-pds">'</span></span>]
 };
 <span class="pl-k">return</span> <span class="pl-smi">Order</span>.<span class="pl-en">getMany</span>(filter);
}

<span class="pl-k">function</span> <span class="pl-en">printOrders</span>(<span class="pl-smi">orders</span>) {
 <span class="pl-k">var</span> strategy <span class="pl-k">=</span> {customer<span class="pl-k">:</span> <span class="pl-c1">null</span>}
 <span class="pl-k">return</span> <span class="pl-smi">orders</span>.<span class="pl-en">toDto</span>(strategy).<span class="pl-en">then</span>(printDtos);
}

<span class="pl-k">function</span> <span class="pl-en">printDtos</span>(<span class="pl-smi">dtos</span>) {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">inspect</span>(dtos,<span class="pl-c1">false</span>,<span class="pl-c1">10</span>));
}

<span class="pl-k">function</span> <span class="pl-en">onOk</span>() {
 <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Done<span class="pl-pds">'</span></span>);
}</pre></div>
</article>
 </div>
</body></html>
