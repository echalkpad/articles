<!DOCTYPE html><html><head><title>Three tools to scan a Linux server for Malware and Rootkits</title></head><body>
<h1>Three tools to scan a Linux server for Malware and Rootkits</h1><p><a href="https://www.howtoforge.com/tutorial/how-to-scan-linux-for-malware-and-rootkits/" target="_new">Original URL</a></p>
<p><blockquote>Servers connected to the internet are seeing a constant level of attacks and scans all day. While a firewall and regular system updates are a good first defense to keep the system safe, you should&hellip;</blockquote></p>
<div><div id="htfContentPage">


<p>Servers connected to the internet are seeing a constant level of attacks and scans all day. While a firewall and regular system updates are a good first defense to keep the system safe, you should also check regularly that no attacker got in. The tools described in this tutorial are made for these sanity checks, they scan for malware, viruses and rootkits. They should be run regularly, e.g. every night and send reports to you by email.&#xA0;You can also use Chkrootkit, Rkhunter and ISPProtect to scan a system when&#xA0;you see suspicious activity like high load, suspicious processes or when the server suddenly starts to send malware.</p>
<p>All these scanners have to be run as root user. Login as root before you continue or run "sudo su" on Ubuntu to become root user.</p>

<h2 id="chkrootkit-linux-rootkit-scanner">chkrootkit - Linux rootkit scanner</h2>
<p>Chkrootkit is a classic rootkit scanner. It checks your server for suspicious rootkit processes and checks for a list of known rootkit files.</p>
<p>Either install the package that comes with your distribution (on Debian and Ubuntu you would run</p>
<p class="command">apt-get install chkrootkit</p>
<p>), or download the sources from <a target="_blank" href="http://www.chkrootkit.org/">www.chkrootkit.org</a> and install manually:</p>
<p class="command">wget --passive-ftp ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz<br>tar xvfz chkrootkit.tar.gz<br>cd chkrootkit-*/<br>make sense</p>
<p>Afterward, you can move the chkrootkit directory somewhere else, e.g. <span class="system">/usr/local/chkrootkit</span>:</p>
<p class="command">cd ..<br>mv chkrootkit-&lt;version&gt;/ /usr/local/chkrootkit</p>
<p>and create a symlink for easy access:</p>
<p class="command">ln -s /usr/local/chkrootkit/chkrootkit&#xA0;/usr/local/bin/chkrootkit</p>
<p>To check your server with chkrootkit, run the command:</p>
<p class="command">chkrootkit</p>
<p>A common false positive report is:</p>
<p class="system">Checking `bindshell'... &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; INFECTED (PORTS: &#xA0;465)</p>
<p>Don't worry when you get this message on an email server, this is the SMTPS (Secure SMTP) port of your mail system and a well known false positive.</p>
<p>You can even run chkrootkit by a cron job and get the results emailed to you. First, find out the path where chkrootkit is installed on your server with:</p>
<p class="command">which chkrootkit</p>
<p>Example:</p>
<p class="system"><a class="__cf_email__" href="https://www.howtoforge.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a>:/tmp/chkrootkit-0.50# which chkrootkit<br>/usr/sbin/chkrootkit</p>
<p>Chkrootkit is installed in the path /usr/sbin/chkrootkit, we need this path in the cron line below:</p>
<p>Run:</p>
<p class="command">crontab -e</p>
<p>To create a cron job like this:</p>
<pre>0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii <span>/</span>usr<span>/</span>sbin<span>/</span>chkrootkit 2&gt;&amp;1 | mail -s "chkrootkit output of my server" <a class="__cf_email__" href="https://www.howtoforge.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a>)</pre>
<p>That would run chkrootkit every night a 3.00h. Replace the path to chkrootkit with the one that you got from which command above and exchange the email address with your real address.</p>

<h2 id="lynis-universal-security-auditing-tool-and-rootkit-scanner">Lynis - Universal security auditing tool and rootkit scanner</h2>
<p>Lynis (formerly rkhunter) is a security auditing tool for Linux and BSD based systems. It performs a detailed auditing of many security aspects and configurations of your system. Download the latest Lynis sources from <a href="https://cisofy.com/download/lynis/">https://cisofy.com/download/lynis/</a>:</p>
<p class="command">cd /tmp<br>wget&#xA0;https://cisofy.com/files/lynis-2.1.1.tar.gz<br>tar xvfz&#xA0;<span>lynis-2.1.1.tar.gz</span><br>mv lynis /usr/local/<br>ln -s /usr/local/lynis/lynis /usr/local/bin/lynis</p>
<p>This will install lynis to the directory <span class="system">/usr/local/lynis</span>&#xA0;and creates a symlink for easy access. Now run</p>
<p class="command">lynis&#xA0;update info</p>
<p>to check if you use the latest version.</p>
<p>Now you can scan your system for rootkits by running:</p>
<p class="command">lynis audit system</p>
<p>Lynis will perform a few checks and then stops to give you some time to read the results. Press [ENTER] to continue with the scan.</p>
<p><a class="fancybox" id="img-lynis" href="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/lynis.png"><img src="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/lynis.png" alt="Lynis system audit." width="524"></a></p>
<p>At the end, it will show you a summary of the scan.</p>
<p><a class="fancybox" id="img-lynis21" href="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/lynis21.png"><img src="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/lynis21.png" alt="Lynis result." width="550"></a></p>
<p>To run Lynis non-interactively, start it with the --quick option:</p>
<p class="command">lynis --quick</p>
<p>To run Lynis automatically at night, create a cron job like this:</p>
<pre>0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii /usr/local/bin/lynis --quick 2&gt;&amp;1 | mail -s "lynis output of my server" <a class="__cf_email__" href="https://www.howtoforge.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a>)</pre>
<p>This will run lynis every night a 3.00h. Replace the email address with your real address.</p>

<h2 id="ispprotect-website-malware-scanner">ISPProtect - Website malware scanner</h2>
<p><a href="http://ispprotect.com/">ISPProtect</a>&#xA0;is a malware scanner for web servers, it scans for malware in website files and CMS systems like Wordpress, Joomla, Drupal etc. If you run a web hosting server, then the hosted websites are the most attacked part of your server and it is recommended to do sanity checks on them regularly. ISPProtect contains&#xA0;3 scanning engines: a signature based malware scanner, a heuristic malware scanner, and a scanner to show the installation directories of outdated CMS systems. ISPProtect is not free software, but there is a free trial that can be used without registration to test it or clean an infected system.</p>
<p>ISPProtect requires PHP to be installed on the server,&#xA0;this should be the case on most hosting systems. In case you don't have a command line&#xA0;PHP installed yet, execute:</p>
<p class="command">apt-get install php5-cli</p>
<p>on Debian or Ubuntu or:</p>
<p class="command">yum install php</p>
<p>on Fedora and CentOS.</p>
<p>Run the following commands to install ISPProtect.</p>
<pre>mkdir -p /usr/local/ispprotect
chown -R root:root /usr/local/ispprotect
chmod -R 750 /usr/local/ispprotect
cd /usr/local/ispprotect
wget http://www.ispprotect.com/download/ispp_scan.tar.gz
tar xzf ispp_scan.tar.gz
rm -f ispp_scan.tar.gz
ln -s /usr/local/ispprotect/ispp_scan /usr/local/bin/ispp_scan</pre>
<p>To start ISPProtect, run:</p>
<p class="command">ispp_scan</p>
<p>The scanner automatically checks for updates, then asks for the key (enter the word "trial" here) and then asks for the path of the websites, normally thats /var/www.</p>
<p><a class="fancybox" id="img-ispprotect" href="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/big/ispprotect.png"><img src="https://www.howtoforge.com/images/how-to-scan-linux-for-malware/ispprotect.png" alt="ISPProtect malware scan." width="550"></a></p>

<p class="system">Please enter scan key: &lt;-- trial<br>Please enter path to scan: &lt;-- /var/www</p>
<p>The scanner will now start the scan. The scanning progress is shown. The names of the infected files are shown on the screen at the end of the scan and the results are stored in file sin the ISPProtect install directory for later use:</p>
<p class="system">After the scan is completed, you will find the results also in the following files:<br>Malware =&gt; /usr/local/ispprotect/found_malware_20161401174626.txt<br>Wordpress =&gt; /usr/local/ispprotect/software_wordpress_20161401174626.txt<br>Joomla =&gt; /usr/local/ispprotect/software_joomla_20161401174626.txt<br>Drupal =&gt; /usr/local/ispprotect/software_drupal_20161401174626.txt<br>Mediawiki =&gt; /usr/local/ispprotect/software_mediawiki_20161401174626.txt<br>Contao =&gt; /usr/local/ispprotect/software_contao_20161401174626.txt<br>Magentocommerce =&gt; /usr/local/ispprotect/software_magentocommerce_20161401174626.txt<br>Woltlab Burning Board =&gt; /usr/local/ispprotect/software_woltlab_burning_board_20161401174626.txt<br>Cms Made Simple =&gt; /usr/local/ispprotect/software_cms_made_simple_20161401174626.txt<br>Phpmyadmin =&gt; /usr/local/ispprotect/software_phpmyadmin_20161401174626.txt<br>Typo3 =&gt; /usr/local/ispprotect/software_typo3_20161401174626.txt<br>Roundcube =&gt; /usr/local/ispprotect/software_roundcube_20161401174626.txt<br>Starting scan level 1 ...</p>
<p>To run ISPProtect automatically&#xA0;as nightly cronjob, create a cron file with nano:</p>
<p class="command">nano /etc/cron.d/ispprotect</p>
<p>and insert the following line:</p>
<pre>0 3 articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii articles _articles bin CAs devops Documents dotfiles gethtml go hnews jason js netdata start-thesrc thesrc ucii root	/usr/local/ispprotect/ispp_scan --update &amp;&amp; /usr/local/ispprotect/ispp_scan --path=/var/www <a class="__cf_email__" href="https://www.howtoforge.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a> --non-interactive --scan-key=AAA-BBB-CCC-DDD</pre>
<p>Replace "<a class="__cf_email__" href="https://www.howtoforge.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a>" with your email address, the scan report is send to this address. Then exchange "AAA-BBB-CCC-DDD" with your license key. You can get a license key <a href="http://ispprotect.com/">here</a>.</p>
<div>
<p><img src="https://www.howtoforge.com/images/pdficon_small.png"> <a href="https://www.howtoforge.com/subscription/">view as pdf</a> | <img src="https://www.howtoforge.com/images/print.gif"> <a href="https://www.howtoforge.com/subscription/">print</a></p>
</div>
<div>
<p><b>Share this page:</b></p>



</div>
</div>
 
 
</div>
</body></html>
