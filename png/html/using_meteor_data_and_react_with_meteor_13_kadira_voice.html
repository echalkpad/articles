<!DOCTYPE html><html><head><title>Using Meteor Data and React with Meteor 1.3 — KADIRA VOICE</title></head><body>
<h1>Using Meteor Data and React with Meteor 1.3 — KADIRA VOICE</h1><p><a href="https://voice.kadira.io/using-meteor-data-and-react-with-meteor-1-3-13cb0935dedb?gi=9ab61467c15b" target="_new">Original URL</a></p>
<p><blockquote>In a previous post, I talked about how to use React with Meteor 1.3. In that post, I showed how to get React from NPM and use FlowRouter to build a simple app.Getting Started with Meteor 1.3 and</blockquote></p>
<div><div class="section-inner layoutSingleColumn"><p name="bfb0" id="bfb0" class="graf--p graf-after--h3">In a <a href="https://voice.kadira.io/getting-started-with-meteor-1-3-and-react-15e071e41cd1" class="markup--anchor markup--p-anchor" rel="nofollow">previous post</a>, I talked about how to use React with Meteor 1.3. In that post, I showed how to get React from NPM and use FlowRouter to build a simple app.</p><div name="dcea" id="dcea" class="graf--mixtapeEmbed graf-after--p"><a href="https://voice.kadira.io/getting-started-with-meteor-1-3-and-react-15e071e41cd1#.ix87q6ay4" class="js-mixtapeImage mixtapeImage u-ignoreBlock"></a><a href="https://voice.kadira.io/getting-started-with-meteor-1-3-and-react-15e071e41cd1#.ix87q6ay4" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://voice.kadira.io/getting-started-with-meteor-1-3-and-react-15e071e41cd1#.ix87q6ay4" rel="nofollow"><strong class="markup--strong markup--mixtapeEmbed-strong">Getting Started with Meteor 1.3 and React</strong><br><em class="markup--em markup--mixtapeEmbed-em">Meteor is working on the 1.3 release and it will be one of the greatest releases ever. It comes with ES2015 module&#x2026;</em>voice.kadira.io</a></div><p name="3d35" id="3d35" class="graf--p graf-after--mixtapeEmbed">This is a sequel to that, where I show how to use Meteor&#x2019;s data system with React. In technical terms, we are trying to get data with a subscription and render a component based on that data.</p><p name="fdf0" id="fdf0" class="graf--p graf-after--h4">Before we jump into that, we need to learn the idea behind &#x201C;React Container Pattern&#x201D;. It will allow you to separate the data layer and the presentation layer (UI) very easily.</p><p name="afc9" id="afc9" class="graf--p graf-after--p">Have a look at the following screenshot:</p><figure name="f452" id="f452" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*ips8Bv9lk2Bn-1GXSf5gKw.png"></div></figure><p name="4f01" id="4f01" class="graf--p graf-after--figure">Here we have a component(BlogPost) that contains the UI. Then we use something called a &#x201C;container component&#x201D; which fetches the data. Then it&#x2019;ll pass that data into the UI component via props.</p><p name="a714" id="a714" class="graf--p graf-after--p">To learn more about this pattern, have a look at the following article:</p><div name="9c49" id="9c49" class="graf--mixtapeEmbed graf-after--p"><a href="https://voice.kadira.io/let-s-compose-some-react-containers-3b91b6d9b7c8#.z0ek0u8he" class="js-mixtapeImage mixtapeImage u-ignoreBlock"></a><a href="https://voice.kadira.io/let-s-compose-some-react-containers-3b91b6d9b7c8#.z0ek0u8he" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://voice.kadira.io/let-s-compose-some-react-containers-3b91b6d9b7c8#.z0ek0u8he" rel="nofollow"><strong class="markup--strong markup--mixtapeEmbed-strong">Let's Compose Some React Containers </strong><br><em class="markup--em markup--mixtapeEmbed-em">Recently, self-sufficient containers became very popular in the React community. They're commonly used in Relay, Redux&#x2026;</em>voice.kadira.io</a></div><blockquote name="935b" id="935b" class="graf--blockquote graf-after--mixtapeEmbed">Now we have enough knowledge about Containers. We can continue.</blockquote><p name="a28b" id="a28b" class="graf--p graf-after--h4">Here we are trying to get a list of MongoDB documents from a collection called <strong class="markup--strong markup--p-strong">Posts</strong>. Here&#x2019;s the publication we&#x2019;ll be using:</p><figure name="75c9" id="75c9" class="graf--figure graf--iframe graf-after--p"></figure><p name="a6c7" id="a6c7" class="graf--p graf-after--h4">Then we need to have a UI component to render those posts. Here it is:</p><figure name="bd92" id="bd92" class="graf--figure graf--iframe graf-after--p"></figure><p name="3de7" id="3de7" class="graf--p graf-after--figure">Here we are using a <a href="https://medium.com/@joshblack/stateless-components-in-react-0-14-f9798f8b992d" class="markup--anchor markup--p-anchor">functional stateless component</a>. It will get data via props and render our UI.</p><blockquote name="af97" id="af97" class="graf--blockquote graf-after--p">We are also using some ES2015 code. If that&#x2019;s something new to you, follow this short course: <a href="https://tutor.mantrajs.com/say-hello-to-ES2015/introduction" class="markup--anchor markup--blockquote-anchor" rel="nofollow"><strong class="markup--strong markup--blockquote-strong">Say Hello to ES2015</strong></a></blockquote><p name="5633" id="5633" class="graf--p graf-after--h4">Now we need to create a container that fetches data. For that, we are using <a href="https://github.com/kadirahq/react-komposer" class="markup--anchor markup--p-anchor" rel="nofollow">react-komposer</a> via NPM. It&#x2019;s a universal React container composing library.</p><figure name="bbe9" id="bbe9" class="graf--figure graf--iframe graf-after--p"></figure><p name="7b4e" id="7b4e" class="graf--p graf-after--figure">As you&#x2019;ve just seen, we write our subscription and data fetching logic as a composer function.</p><p name="1954" id="1954" class="graf--p graf-after--p">This composer function runs inside a Tracker. So, you can use any reactive code within this composer function.</p><p name="10e1" id="10e1" class="graf--p graf-after--p">Once you have the data, you can call the onData function like this:</p><pre name="9de4" id="9de4" class="graf--pre graf-after--p">const posts = Posts.find({}, {sort: {_id: 1}}).fetch();<br>onData(null, {posts});</pre><blockquote name="9c4e" id="9c4e" class="graf--blockquote graf-after--pre">First argument of the composer functions contains props passed to the container. You can use them to load your data.</blockquote><p name="180c" id="180c" class="graf--p graf-after--blockquote">Then, we compose the container like this.</p><pre name="0608" id="0608" class="graf--pre graf-after--p">export default composeWithTracker(composer)(PostList);</pre><p name="2d31" id="2d31" class="graf--p graf-after--pre">At the end you&#x2019;ll get a React component.</p><p name="5f5c" id="5f5c" class="graf--p graf-after--h4">Now it&#x2019;s time to render our container.</p><blockquote name="e4b4" id="e4b4" class="graf--blockquote graf-after--p">Make sure that you render the container, not the UI component.</blockquote><p name="6062" id="6062" class="graf--p graf-after--blockquote">We can do it like this:</p><figure name="e068" id="e068" class="graf--figure graf--iframe graf-after--p"></figure><p name="298a" id="298a" class="graf--p graf-after--figure">Once it&#x2019;s rendered, here&#x2019;s how we can see it in the React Dev tools.</p><figure name="916e" id="916e" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*85Ttsd8DqAW32S7N42zP_w.png"></div></figure><p name="e696" id="e696" class="graf--p graf-after--figure">As you can see, our UI component is wrapped by the container. The container passes data to the UI component via props.</p><p name="a023" id="a023" class="graf--p graf-after--h4">You can compose containers like this and build your whole app. Here&#x2019;s a simple app you can refer to: <a href="https://github.com/kadira-samples/meteor-data-and-react" class="markup--anchor markup--p-anchor" rel="nofollow">https://github.com/kadira-samples/meteor-data-and-react</a></p><p name="4a9f" id="4a9f" class="graf--p graf-after--h3">We created <a href="https://github.com/kadirahq/mantra" class="markup--anchor markup--p-anchor" rel="nofollow">Mantra</a>, extending these ideas further for building maintainable, future-proof Meteor apps.</p><p name="eae6" id="eae6" class="graf--p graf-after--p"><strong class="markup--strong markup--p-strong">It&#x2019;s an application architecture for Meteor.</strong></p><figure name="14b0" id="14b0" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*GB5ezX9fCV6XzYRoS4QOtg.png"></div></figure><p name="dfbc" id="dfbc" class="graf--p graf-after--figure"><a href="https://github.com/kadirahq/mantra" class="markup--anchor markup--p-anchor" rel="nofollow">Give it a try</a>. You&#x2019;ll love it.</p><p name="a8ae" id="a8ae" class="graf--p graf-after--h4"><a href="https://github.com/kadirahq/react-komposer#using-with-meteor" class="markup--anchor markup--p-anchor" rel="nofollow">composeWithTracker</a> runs inside a tracker and it&#x2019;ll stop the tracker when the container is unmounting. Tracker knows how to unsubscribe subscriptions properly.</p><p name="68da" id="68da" class="graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">So, you don&#x2019;t need to worry about it.</em></strong></p><p name="e96f" id="e96f" class="graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">react-komposer</strong> has a built-in loading functionality. It handles that for you. But you can override the default loading component as shown below:</p><pre name="7852" id="7852" class="graf--pre graf-after--p">const MyLoading = () =&gt; (&lt;div&gt;Hmm&#x2026;&lt;/div&gt;);<br>const Container = compose(composerFunction, MyLoading)(Component);</pre><p name="a62f" id="a62f" class="graf--p graf-after--h4">When the container is starting, there is no data. So, it shows the loading screen.</p><p name="b2fa" id="b2fa" class="graf--p graf-after--p">Then, once you put data into the container, it&#x2019;ll stop the loading screen and render the UI component.</p><p name="e0c5" id="e0c5" class="graf--p graf-after--p">If you need to get the loading screen again, you need to send `null` as data:</p><pre name="3b15" id="3b15" class="graf--pre graf-after--p">function composer(props, onData) {<br> ...<br> onData(null, null);<br>};</pre><p name="f273" id="f273" class="graf--p graf-after--h4">You can handle the loading screen inside your component as well. To do that, always send some data to the container, then pass a loading indicator to the UI component via data. Here&#x2019;s an example:</p><figure name="1315" id="1315" class="graf--figure graf--iframe graf-after--p"></figure><p name="dc61" id="dc61" class="graf--p graf-after--h4">This is also similar to the above question. Make sure you are always sending something to the container.</p><p name="b0f3" id="b0f3" class="graf--p graf-after--h4">Yes, of course. Check this:</p><figure name="f30b" id="f30b" class="graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*hx2XQqlxkMfM04fNwG1PCg.png"></div></figure><p name="9200" id="9200" class="graf--p graf-after--h4">For that, you don&#x2019;t need to work with the container. Just add lifecycle hooks to your UI component. See the following example:</p><figure name="97e7" id="97e7" class="graf--figure graf--iframe graf-after--p"></figure><p name="6cc6" id="6cc6" class="graf--p graf-after--h4">By default, container&#x2019;s displayName is something like this:</p><pre name="afbf" id="afbf" class="graf--pre graf-after--p">Container(UIComponentName)</pre><p name="4803" id="4803" class="graf--p graf-after--pre">Container itself is a react component. So, you can simply set a displayName to override the default displayName.</p><pre name="44ff" id="44ff" class="graf--pre graf-after--p">const Container = composeWithTracker(composer)(PostList);<br>Container.displayName = &#x2018;MyContainer&#x2019;;</pre><p name="142f" id="142f" class="graf--p graf-after--h4">You can pass an error to the container as the first argument of onData callback. Then it&#x2019;ll display the error on the UI. But you can easily override it and render a custom error component as shown below.</p><pre name="38fa" id="38fa" class="graf--pre graf-after--p">const MyError = ({error}) =&gt; (&lt;div&gt;Error: {error.message}&lt;/div&gt;);<br>const Container = compose(onPropsChange, null, MyError)(UIComp);</pre><blockquote name="bcd9" id="bcd9" class="graf--blockquote graf-after--pre">Make sure to pass a JavaScript Error object as the error.</blockquote><p name="9681" id="9681" class="graf--p graf-after--h4">Container is also a React component. You can create a container to a container. We have a utility function called <a href="https://github.com/kadirahq/react-komposer/#compose-multiple-containers" class="markup--anchor markup--p-anchor" rel="nofollow">composeAll</a> which helps you to do it.</p><p name="9992" id="9992" class="graf--p graf-after--h4">There is no right or wrong way. But, this is how we load data into a component in modern React. This pattern is used by popular data management libraries such as <a href="https://facebook.github.io/relay/" class="markup--anchor markup--p-anchor" rel="nofollow">Relay</a> and Redux (via <a href="https://github.com/rackt/react-redux" class="markup--anchor markup--p-anchor" rel="nofollow">react-redux</a>).</p><p name="13da" id="13da" class="graf--p graf-after--h4"><a href="https://github.com/meteor/react-packages/issues/169#issuecomment-175920636" class="markup--anchor markup--p-anchor" rel="nofollow">Seems like it&#x2019;ll be.</a></p><blockquote name="03ba" id="03ba" class="graf--pullquote pullquote graf-after--p graf--last">Follow <a href="https://voice.kadira.io/" class="markup--anchor markup--pullquote-anchor" rel="nofollow">KADIRA VOICE</a> for articles like this.</blockquote></div></div>
</body></html>
