<!DOCTYPE html><html><head><title>Using FeathersJS as an open source alternative to Firebase — All about FeathersJS</title></head><body>
<h1>Using FeathersJS as an open source alternative to Firebase — All about FeathersJS</h1><p><a href="https://medium.com/all-about-feathersjs/using-feathersjs-as-an-open-source-alternative-to-firebase-b5d93c200cee" target="_new">Original URL</a></p>
<p><blockquote>Firebase is a popular backend-as-a-service platform to build mobile or web applications that connect to a RESTful or real-time API. It makes it easy to get an application up and running quickly but&hellip;</blockquote></p>
<section name="52ca" class=" section--body section--first section--last" score="41.25"><div class="section-content" score="32.5"><div class="section-inner layoutSingleColumn" score="-13.75"><p name="2cfa" id="2cfa" class="graf--p"><a href="https://www.firebase.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Firebase</a> is a popular backend-as-a-service platform to build mobile or web applications that connect to a RESTful or real-time API. It makes it easy to get an application up and running quickly but if you are looking for more hosting options (Firebase plans can get pricy and you are locked into the platform) or are curious about full stack development in NodeJS, <a href="http://feathersjs.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Feathers</a> is an open source alternative that provides very similar functionality, but giving you much more control.</p><p name="933d" id="933d" class="graf--p">In this post I’d like to show how you can very simply create your own self-hosted clone of the real-time <a href="http://hackeryou.github.io/SlackerYou/" class="markup--anchor markup--p-anchor" rel="nofollow">SlackerYou</a> (jQuery + Firebase) chat demo that <a href="http://wesbos.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Wes</a> created for <a href="http://hackeryou.com/" class="markup--anchor markup--p-anchor" rel="nofollow">HackerYou</a> but with Feathers instead of Firebase.</p><figure name="ac81" id="ac81" class="graf--figure graf--iframe" score="-13.75"><figcaption class="imageCaption">The SlackerYou jQuery + Firebase chat</figcaption></figure><p name="0225" id="0225" class="graf--p">To get started, let’s clone the <a href="https://github.com/HackerYou/SlackerYou%5D" class="markup--anchor markup--p-anchor" rel="nofollow">SlackerYou repository</a> (or your own fork ) which we will then modify to use our own server.</p><blockquote name="294e" id="294e" class="graf--blockquote">git clone <a href="mailto:git@github.com" class="markup--anchor markup--blockquote-anchor" rel="nofollow">git@github.com</a>:HackerYou/SlackerYou.git<br>cd SlackerYou</blockquote><p name="43c6" id="43c6" class="graf--p">If you want to try out everything right away, clone the <a href="https://github.com/feathersjs/SlackerYou" class="markup--anchor markup--p-anchor" rel="nofollow">Feathers SlackerYou</a> by running:</p><blockquote name="9fb1" id="9fb1" class="graf--blockquote">git clone <a href="mailto:git@github.com" class="markup--anchor markup--blockquote-anchor" rel="nofollow">git@github.com</a>:feathersjs/SlackerYou.git<br>cd SlackerYou<br>npm install<br>npm start</blockquote><p name="c778" id="c778" class="graf--p">The server will be available at <a href="http://localhost:3030" class="markup--anchor markup--p-anchor">http://localhost:3030</a></p><p name="5560" id="5560" class="graf--p">Creating a real-time server using Feathers is actually really quick. With <a href="https://nodejs.org/en/" class="markup--anchor markup--p-anchor" rel="nofollow">NodeJS</a> installed, in the repository folder we can run</p><blockquote name="f120" id="f120" class="graf--blockquote">npm install feathers body-parser feathers-nedb</blockquote><p name="13b0" id="13b0" class="graf--p">which will install the <a href="https://github.com/feathersjs/feathers" class="markup--anchor markup--p-anchor" rel="nofollow">feathers</a>, <a href="https://www.npmjs.com/package/body-parser" class="markup--anchor markup--p-anchor" rel="nofollow">body-parser</a> (to make it possible to send JSON to the REST API) and <a href="https://github.com/feathersjs/feathers-nedb" class="markup--anchor markup--p-anchor" rel="nofollow">feathers-nedb</a> packages. <a href="https://github.com/louischatriot/nedb" class="markup--anchor markup--p-anchor" rel="nofollow">NEDB</a> is a standalone file-system database so we won’t have to set up our own database server. Putting it all together looks like this:</p><figure name="5570" id="5570" class="graf--figure graf--iframe" score="-13.75"></figure><p name="0473" id="0473" class="graf--p">We create a new Feathers application, enable connecting via REST and websockets (Socket.io in this case) and add the JSON body parser. Then we register a messages service that uses an NEDB database called <em class="markup--em markup--p-em">messages</em>. Last we add a static webserver for the current folder (so that we can host the HTML and JavaScript files) and run everything on port 3030. We can start the server with</p><blockquote name="1015" id="1015" class="graf--blockquote">node app.js</blockquote><p name="71f9" id="71f9" class="graf--p">Our messages endpoint is now running at <a href="http://localhost:3030/messages" class="markup--anchor markup--p-anchor">http://localhost:3030/messages</a> (but currently just showing an empty array).</p><p name="4cdd" id="4cdd" class="graf--p">The SlackerYou client is still talking to Firebase so now it is time to update the HTML and jQuery parts to use our own newly created Feathers server instead. The <strong class="markup--strong markup--p-strong">only</strong> thing to change in <em class="markup--em markup--p-em">index.html</em> is to load Socket.io and feathers-client instead of the Firebase JavaScript:</p><figure name="b9ac" id="b9ac" class="graf--figure graf--iframe" score="-13.75"></figure><p name="dca1" id="dca1" class="graf--p">Next we can update <em class="markup--em markup--p-em">scripts.js</em>. We can re-use almost all of the existing code including the <em class="markup--em markup--p-em">createMessage</em> method that adds a new message with jQuery. What will change is everything that is specific to Firebase. Instead, we first create a Socket.io connection to our server, then create a Feathers client and connect to the <em class="markup--em markup--p-em">messages</em> service:</p><pre name="3082" id="3082" class="graf--pre"><em class="markup--em markup--pre-em">// Create a Socket.io connection</em><br><strong class="markup--strong markup--pre-strong">var</strong> socket = io();<br><em class="markup--em markup--pre-em">// Create a Feathers client that uses that connection</em><br><strong class="markup--strong markup--pre-strong">var</strong> app = feathers().configure(feathers.socketio(socket));<br><em class="markup--em markup--pre-em">// Get the messages service</em><br><strong class="markup--strong markup--pre-strong">var</strong> messages = app.service('messages');</pre><p name="f392" id="f392" class="graf--p">In the form submit handler we just need to replace</p><pre name="de55" id="de55" class="graf--pre">messagesRef.push(message);</pre><p name="5334" id="5334" class="graf--p">With</p><pre name="f8ce" id="f8ce" class="graf--pre">messages.create(message);</pre><p name="49c9" id="49c9" class="graf--p">Then we can replace the bottom of the script with the Feathers way of listening to new messages and getting all messages when a user loads the page:</p><pre name="c525" id="c525" class="graf--pre"><em class="markup--em markup--pre-em">// Add new messages</em><br>messages.on('created', addMessage);</pre><pre name="7b8c" id="7b8c" class="graf--pre"><em class="markup--em markup--pre-em">// Find all existing messages and add them to the page</em><br>messages.find({ $limit: 10 }, <strong class="markup--strong markup--pre-strong">function</strong>(error, messages) {<br> <strong class="markup--strong markup--pre-strong">if</strong>(messages) {<br> messages.forEach(addMessage);<br> }<br>});</pre><p name="7198" id="7198" class="graf--p">Everything put together looks like this:</p><figure name="6bbc" id="6bbc" class="graf--figure graf--iframe" score="-13.75"></figure><p name="9220" id="9220" class="graf--p">That’s it! If you now go to <a href="http://localhost:3030/" class="markup--anchor markup--p-anchor" rel="nofollow">http://localhost:3030/</a> you have a working real-time chat that stores its messages in a file database (you can see all messages at <a href="http://localhost:3030/messages" class="markup--anchor markup--p-anchor">http://localhost:3030/messages</a>).</p><p name="5b43" id="5b43" class="graf--p">Now it is time for some polishing. Right now, when a new user comes to the page our chat will always load all messages in no particular order (although it might be by the time of creation it is not guaranteed). The best way to get all messages in the correct order is to add a <em class="markup--em markup--p-em">created_at</em> timestamp to each message on the server and have <em class="markup--em markup--p-em">find</em> always sort the messages by that timestamp (oldest first). Then we also want to only return the last (newest) 10 messages. This is where <a href="https://github.com/feathersjs/feathers-hooks" class="markup--anchor markup--p-anchor" rel="nofollow">feathers-hooks</a> come in. Hooks allow us to hook into a service before or after a service method runs (but before it gets sent to the client). To get hooks we run</p><blockquote name="3133" id="3133" class="graf--blockquote">npm install feathers-hooks</blockquote><p name="71e3" id="71e3" class="graf--p">And then we can register hooks, like adding a <em class="markup--em markup--p-em">created_at</em> timestamp to a message <em class="markup--em markup--p-em">before</em> it gets sent to the database like this:</p><pre name="50aa" id="50aa" class="graf--pre">app.service('messages'). before({<strong class="markup--strong markup--pre-strong"><br> </strong>create: <strong class="markup--strong markup--pre-strong">function</strong>(hook, next) {<br> // Add the created_at date<br> hook.data.created_at = new Date();<br> // Go to the next step (save to database)<br> next();<br> }<br>});</pre><p name="3f39" id="3f39" class="graf--p">The complete server now looks like this:</p><figure name="6cca" id="6cca" class="graf--figure graf--iframe" score="-13.75"></figure><p name="6652" id="6652" class="graf--p">To see the effect of the hooks, let’s delete the old database and restart the server:</p><blockquote name="9735" id="9735" class="graf--blockquote">rm -rf db-data<br>node app.js</blockquote><p name="18eb" id="18eb" class="graf--p">Now we have our own self-hosted real-time chat that only loads the newest 10 messages.</p><p name="d679" id="d679" class="graf--p graf--last">Firebase is great to get up and running quickly without a backend but if you are looking for an open source option with more freedom or are curious about full stack development with NodeJS, Feathers is a great way to get very similar functionality with only a few lines of code. If you want to learn more, for example how to use other databases like MongoDB, write your own services or how to use other JavaScript frameworks to build real-time applications, head over to the <a href="http://feathersjs.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Feathers website</a> and <a href="http://feathersjs.com/learn/#" class="markup--anchor markup--p-anchor" rel="nofollow">guides</a>.</p></div></div></section>
</body></html>
