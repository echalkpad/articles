<!DOCTYPE html><html><head><title>Using Couchbase Server In A GoLang Web Application</title></head><body>
<h1>Using Couchbase Server In A GoLang Web Application</h1><p><a href="https://www.thepolyglotdeveloper.com/2016/08/using-couchbase-server-golang-web-application/" target="_new">Original URL</a></p>
<p><blockquote>Not too long ago I wrote an article regarding how to create a RESTful API using the Go programming language, but in it I only used mock data rather than an actual database. &#xA0;What happens if we&hellip;</blockquote></p>
<div><div class="entry-content">
 <p>Not too long ago I wrote an article regarding how to <a href="https://www.thepolyglotdeveloper.com/2016/07/create-a-simple-restful-api-with-golang/" target="_blank">create a RESTful API using the Go programming language</a>, but in it I only used mock data rather than an actual database. &#xA0;What happens if we want to use a database with GoLang? &#xA0;What database, or more importantly, what kind of database should be used? &#xA0;Most APIs transfer data in JSON format, so it might make sense to store data in the same format. &#xA0;This means that a relational database might not make sense. &#xA0;Instead, NoSQL databases fit quite well when it comes to RESTful APIs. &#xA0;A popular NoSQL database that stores data in JSON format is the open source <a href="http://www.couchbase.com" target="_blank">Couchbase Server</a>.</p>
<p>We&#x2019;re going to take a look at how to include Couchbase Server into our RESTful web application written in the <a href="https://golang.org/" target="_blank">Go</a> programming language.</p>

<p>The RESTful API example I wrote previously is going to be the foundation to this tutorial, so if you haven&#x2019;t checked it out, I definitely recommend you do. &#xA0;However, you won&#x2019;t be completely lost if you don&#x2019;t as I&#x2019;m going to try to relay all the necessary information.</p>
<p>At this point I&#x2019;m going to assume you have GoLang installed and configured on your machine.</p>
<h2>Creating a New Project with Dependencies</h2>
<p>We&#x2019;re going to create a new GoLang project for simplicity. &#xA0;Using the Terminal (Mac and Linux) or Command Prompt (Windows), execute the following:</p>
 
<div id="crayon-57a63d204081a738244491" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">Create new GoLang Project</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d204081a738244491-1"><span class="crayon-r">mkdir</span><span class="crayon-o">-</span><span class="crayon-i">p</span><span class="crayon-v">$GOPATH</span><span class="crayon-o">/</span><span class="crayon-v">src</span><span class="crayon-o">/</span><span class="crayon-v">github</span><span class="crayon-e">.com</span><span class="crayon-o">/</span><span class="crayon-v">nraboy</span><span class="crayon-o">/</span><span class="crayon-v">cbproject</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>Essentially I just created those directories with the command above. &#xA0;If the command doesn&#x2019;t work on your operating system, create them manually.</p>
<p>Inside our project directory, we&#x2019;re going to be working with a file called&#xA0;<strong>main.go</strong>. &#xA0;It will be the only file in our project. &#xA0;Before we start coding, we should probably download any project dependencies.</p>
<p>From the Command Prompt or Terminal, execute the following:</p>
 
<div id="crayon-57a63d204082a353438047" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">Get External GoLang Dependencies</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d204082a353438047-1"><span class="crayon-e">go </span><span class="crayon-r">get</span><span class="crayon-v">github</span><span class="crayon-e">.com</span><span class="crayon-o">/</span><span class="crayon-v">satori</span><span class="crayon-o">/</span><span class="crayon-v">go</span><span class="crayon-e">.uuid</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d204082a353438047-2"><span class="crayon-e">go </span><span class="crayon-r">get</span><span class="crayon-v">github</span><span class="crayon-e">.com</span><span class="crayon-o">/</span><span class="crayon-v">couchbase</span><span class="crayon-o">/</span><span class="crayon-e">gocb</span></p><p class="crayon-line" id="crayon-57a63d204082a353438047-3"><span class="crayon-e">go </span><span class="crayon-r">get</span><span class="crayon-v">github</span><span class="crayon-e">.com</span><span class="crayon-o">/</span><span class="crayon-v">gorilla</span><span class="crayon-o">/</span><span class="crayon-v">mux</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>The dependencies above include a package for generating UUID values that we&#x2019;ll use for document ids, the Couchbase Go SDK, and Mux for expanding the routing capabilities of our HTTP server.</p>
<h2>Configuring Couchbase Server for the GoLang Project</h2>
<p>Before we can start coding we need to make sure Couchbase Server is configured and ready for use. &#xA0;We won&#x2019;t be seeing how to install Couchbase Server. &#xA0;If you are using a <a href="https://www.youtube.com/watch?v=L1wNemXGd9Q" target="_blank">Mac</a>, <a href="https://www.youtube.com/watch?v=z8BcuXDJrDY" target="_blank">Linux</a>, or <a href="https://www.youtube.com/watch?v=dZpnANelV2M" target="_blank">Windows</a> machine, you can see one of the available getting started guides for installation. &#xA0;Instead we&#x2019;ll be configuring a bucket for storing all the NoSQL documents for our application.</p>
<p>The goal here is to create a Couchbase bucket called&#xA0;<strong>restful-sample</strong> that has appropriate indexes for performing <a href="http://www.couchbase.com/n1ql" target="_blank">N1QL</a> queries via our application code.</p>
<p>Inside the Couchbase administrative dashboard, choose&#xA0;<strong>Data Buckets</strong> and then choose&#xA0;<strong>Create New Data Bucket</strong>. &#xA0;Give the new bucket a name and define a storage capacity.</p>
<p><a href="https://www.thepolyglotdeveloper.com/wp-content/uploads/2016/07/couchbase-create-bucket.gif"><img class="alignnone wp-image-5042 size-full" src="https://www.thepolyglotdeveloper.com/wp-content/uploads/2016/07/couchbase-create-bucket.gif" alt="Couchbase Server Create Bucket" width="1094"></a></p>
<p>Next we need to create indexes for this new bucket.</p>
<p>When it comes to creating indexes there are a few ways to do this. &#xA0;If you&#x2019;re using Couchbase 4.5 or higher you can use the Query Workbench. &#xA0;In the Query Workbench execute the following query:</p>
 
<div id="crayon-57a63d2040832468583130" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">Create Primary Index for N1QL Queries</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d2040832468583130-1"><span class="crayon-e">CREATE </span><span class="crayon-e">PRIMARY </span><span class="crayon-e">INDEX </span><span class="crayon-i">ON</span><span class="crayon-sy">`</span><span class="crayon-v">restful</span><span class="crayon-o">-</span><span class="crayon-v">sample</span><span class="crayon-sy">`</span><span class="crayon-e">USING </span><span class="crayon-v">GSI</span><span class="crayon-sy">;</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>At least one index is required to use N1QL. &#xA0;More indexes that have deeper complexity than the one I demonstrated will result in faster querying.</p>
<p><a href="https://www.thepolyglotdeveloper.com/wp-content/uploads/2016/07/couchbase-create-primary-index.gif"><img class="alignnone wp-image-5044 size-full" src="https://www.thepolyglotdeveloper.com/wp-content/uploads/2016/07/couchbase-create-primary-index.gif" alt="Couchbase Server Create Primary Index" width="1094"></a></p>
<p>If you don&#x2019;t have Couchbase Server 4.5 or higher installed, a different strategy must be used for creating indexes. &#xA0;You must use the Couchbase Query Shell (CBQ) that ships with Couchbase Server 4.0 and higher. &#xA0;For information on how to access it, you can visit <a href="http://developer.couchbase.com/documentation/server/current/getting-started/first-n1ql-query.html" target="_blank">here</a>. &#xA0;The same query used in the Query Workbench should be used in the shell.</p>
<p>At this point we can focus on the actual application.</p>
<h2>Designing the RESTful Web Application</h2>
<p>With all the setup out of the way we can start coding the application. &#xA0;This application will have five basic endpoints for handling information about people. &#xA0;This is a standard create, retrieve, update, and delete (CRUD) application. &#xA0;Each endpoint will communicate with the NoSQL database differently.</p>
<p>Inside the project&#x2019;s&#xA0;<strong>$GOPATH/src/github.com/nraboy/cbproject/main.go</strong> file, add the following code:</p>
 
<div id="crayon-57a63d2040839443344331" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">$GOPATH/src/github.com/nraboy/cbproject/main.go</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">
<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num">100</p><p class="crayon-num">101</p><p class="crayon-num crayon-striped-num">102</p><p class="crayon-num">103</p><p class="crayon-num crayon-striped-num">104</p><p class="crayon-num">105</p><p class="crayon-num crayon-striped-num">106</p><p class="crayon-num">107</p><p class="crayon-num crayon-striped-num">108</p><p class="crayon-num">109</p></div>
</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d2040839443344331-1"><span class="crayon-st">package</span><span class="crayon-e">main</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-3"><span class="crayon-st">import</span><span class="crayon-sy">(</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-4"><span class="crayon-s">"encoding/json"</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-5"><span class="crayon-s">"log"</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-6"><span class="crayon-s">"net/http"</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-8"><span class="crayon-s">"github.com/couchbase/gocb"</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-9"><span class="crayon-s">"github.com/gorilla/mux"</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-10"><span class="crayon-s">"github.com/satori/go.uuid"</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-13"><span class="crayon-st">type</span><span class="crayon-e">Person</span><span class="crayon-st">struct</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-14"><span class="crayon-e">ID&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">string</span><span class="crayon-sy">`</span><span class="crayon-v">json</span><span class="crayon-o">:</span><span class="crayon-s">"id,omitempty"</span><span class="crayon-sy">`</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-15"><span class="crayon-e">Firstname </span><span class="crayon-t">string</span><span class="crayon-sy">`</span><span class="crayon-v">json</span><span class="crayon-o">:</span><span class="crayon-s">"firstname,omitempty"</span><span class="crayon-sy">`</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-16"><span class="crayon-e">Lastname&#xA0;&#xA0;</span><span class="crayon-t">string</span><span class="crayon-sy">`</span><span class="crayon-v">json</span><span class="crayon-o">:</span><span class="crayon-s">"lastname,omitempty"</span><span class="crayon-sy">`</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-17"><span class="crayon-e">Email&#xA0;&#xA0;&#xA0;&#xA0; </span><span class="crayon-t">string</span><span class="crayon-sy">`</span><span class="crayon-v">json</span><span class="crayon-o">:</span><span class="crayon-s">"email,omitempty"</span><span class="crayon-sy">`</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-20"><span class="crayon-st">type</span><span class="crayon-e">N1qlPerson</span><span class="crayon-st">struct</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-21"><span class="crayon-e">Person </span><span class="crayon-i">Person</span><span class="crayon-sy">`</span><span class="crayon-v">json</span><span class="crayon-o">:</span><span class="crayon-s">"person"</span><span class="crayon-sy">`</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-24"><span class="crayon-st">var</span><span class="crayon-e ">bucket *</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">Bucket</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-26"><span class="crayon-st">func</span><span class="crayon-e">GetPersonEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-27"><span class="crayon-st">var</span><span class="crayon-e">n1qlParams</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-st">interface</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-28"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT create_a_simple_restful_api_with_golang.md data.json data_ml devops docker embedded gaming github go html javascript linux mobile png programming science social tidy url_to_filename.csv web_dev FROM `restful-sample` AS person WHERE META(person).id = $1"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-29"><span class="crayon-v">params</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">Vars</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-30"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">params</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-31"><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-32"><span class="crayon-st">var</span><span class="crayon-e">row </span><span class="crayon-e">N1qlPerson</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-33"><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-e">One</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-34"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-v">Person</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-37"><span class="crayon-st">func</span><span class="crayon-e">GetPeopleEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-38"><span class="crayon-st">var</span><span class="crayon-i">person</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-e">Person</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-39"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT create_a_simple_restful_api_with_golang.md data.json data_ml devops docker embedded gaming github go html javascript linux mobile png programming science social tidy url_to_filename.csv web_dev FROM `restful-sample` AS person"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-40"><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">nil</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-41"><span class="crayon-st">var</span><span class="crayon-e">row </span><span class="crayon-e">N1qlPerson</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-42"><span class="crayon-st">for</span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-e">Next</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-43"><span class="crayon-v">person</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">,</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-v">Person</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-45"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-48"><span class="crayon-st">func</span><span class="crayon-e">CreatePersonEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-49"><span class="crayon-st">var</span><span class="crayon-e">person</span><span class="crayon-e">Person</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-50"><span class="crayon-st">var</span><span class="crayon-e">n1qlParams</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-st">interface</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-51"><span class="crayon-v">_</span><span class="crayon-o">=</span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewDecoder</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Decode</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-52"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"INSERT INTO `restful-sample` (KEY, VALUE) VALUES ($1, {'firstname': $2, 'lastname': $3, 'email': $4})"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-53"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">uuid</span><span class="crayon-sy">.</span><span class="crayon-e">NewV4</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-54"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Firstname</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-55"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Lastname</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-56"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Email</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-57"><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-v">err</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-58"><span class="crayon-st">if</span><span class="crayon-v">err</span><span class="crayon-o">!=</span><span class="crayon-e">nil</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-59"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">WriteHeader</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-60"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">Write</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-t">byte</span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">.</span><span class="crayon-e">Error</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-61"><span class="crayon-st">return</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-63"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-66"><span class="crayon-st">func</span><span class="crayon-e">UpdatePersonEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-67"><span class="crayon-st">var</span><span class="crayon-e">person</span><span class="crayon-e">Person</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-68"><span class="crayon-st">var</span><span class="crayon-e">n1qlParams</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-st">interface</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-69"><span class="crayon-v">_</span><span class="crayon-o">=</span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewDecoder</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Decode</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-70"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"UPDATE `restful-sample` USE KEYS $1 SET firstname = $2, lastname = $3, email = $4"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-71"><span class="crayon-v">params</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">Vars</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-72"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">params</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-73"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Firstname</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-74"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Lastname</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-75"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">person</span><span class="crayon-sy">.</span><span class="crayon-v">Email</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-76"><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-v">err</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-77"><span class="crayon-st">if</span><span class="crayon-v">err</span><span class="crayon-o">!=</span><span class="crayon-e">nil</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-78"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">WriteHeader</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-79"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">Write</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-t">byte</span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">.</span><span class="crayon-e">Error</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-80"><span class="crayon-st">return</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-82"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-85"><span class="crayon-st">func</span><span class="crayon-e">DeletePersonEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-86"><span class="crayon-st">var</span><span class="crayon-e">n1qlParams</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-st">interface</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-87"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"DELETE FROM `restful-sample` AS person WHERE META(person).id = $1"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-88"><span class="crayon-v">params</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">Vars</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-89"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">params</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-90"><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-v">err</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-91"><span class="crayon-st">if</span><span class="crayon-v">err</span><span class="crayon-o">!=</span><span class="crayon-e">nil</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-92"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">WriteHeader</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-93"><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">Write</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-t">byte</span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">.</span><span class="crayon-e">Error</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-94"><span class="crayon-st">return</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-96"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-e">Person</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-99"><span class="crayon-st">func</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-100"><span class="crayon-v">router</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">NewRouter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-101"><span class="crayon-v">cluster</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">Connect</span><span class="crayon-sy">(</span><span class="crayon-s">"couchbase://localhost"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-102"><span class="crayon-v">bucket</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">=</span><span class="crayon-v">cluster</span><span class="crayon-sy">.</span><span class="crayon-e">OpenBucket</span><span class="crayon-sy">(</span><span class="crayon-s">"restful-sample"</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-103"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people"</span><span class="crayon-sy">,</span><span class="crayon-v">GetPeopleEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"GET"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-104"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">GetPersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"GET"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-105"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people"</span><span class="crayon-sy">,</span><span class="crayon-v">CreatePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"PUT"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-106"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">UpdatePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"POST"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040839443344331-107"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">DeletePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"DELETE"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040839443344331-108"><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">Fatal</span><span class="crayon-sy">(</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">ListenAndServe</span><span class="crayon-sy">(</span><span class="crayon-s">":12345"</span><span class="crayon-sy">,</span><span class="crayon-v">router</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>There is a lot going on in the above code so it would be a good idea to break it down.</p>
<p>The first thing we&#x2019;re doing is importing all the dependencies that we downloaded earlier in this article. &#xA0;With the dependencies included in the project we can define two structs that will represent the JSON data that we work with. &#xA0;The&#xA0;<code>Person</code> struct will have the essential information about a particular person and it will be saved like this as a JSON document in the database. &#xA0;When querying data, result sets are wrapped in a parent JSON object, thus the need for the&#xA0;<code>N1qlPerson</code> struct. &#xA0;Data will look like this when queried:</p>
 
<div id="crayon-57a63d2040844733201947" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">JSON Data from Queries</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040844733201947-2"><span class="crayon-s">"person"</span><span class="crayon-o">:</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d2040844733201947-3"><span class="crayon-s">"id"</span><span class="crayon-o">:</span><span class="crayon-s">"1234"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040844733201947-4"><span class="crayon-s">"firstname"</span><span class="crayon-o">:</span><span class="crayon-s">"Nic"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-57a63d2040844733201947-5"><span class="crayon-s">"lastname"</span><span class="crayon-o">:</span><span class="crayon-s">"Raboy"</span><span class="crayon-sy">,</span></p><div class="crayon-line crayon-striped-line" id="crayon-57a63d2040844733201947-6"><span class="crayon-s">"email"</span><span class="crayon-o">:</span><span class="crayon-s">"<a class="__cf_email__" href="https://www.thepolyglotdeveloper.com/cdn-cgi/l/email-protection">[email&#xA0;protected]</a>"</span></div></div></td>
</tr>
</table>
</div>
</div>
 

<p>Inside the structs you&#x2019;ll notice the use of the&#xA0;<code>omitempty</code> tag. &#xA0;This means that if any property is empty or null, it will not be included in the JSON result.</p>
<p>Before we jump into the endpoint functions we have the following:</p>
 
<div id="crayon-57a63d204084a310844162" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">$GOPATH/src/github.com/nraboy/cbproject/main.go</span>
</p>



</div>
 

<p>This&#xA0;<code>bucket</code> variable is defined outside the&#xA0;<code>main</code> function making it global to the application. &#xA0;This will represent our open Couchbase bucket and be used when querying data.</p>
<p>Let&#x2019;s skip down to the project&#x2019;s&#xA0;<code>main</code> function:</p>
 
<div id="crayon-57a63d2040850537128346" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">$GOPATH/src/github.com/nraboy/cbproject/main.go</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d2040850537128346-1"><span class="crayon-st">func</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040850537128346-2"><span class="crayon-v">router</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">NewRouter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040850537128346-3"><span class="crayon-v">cluster</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">Connect</span><span class="crayon-sy">(</span><span class="crayon-s">"couchbase://localhost"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040850537128346-4"><span class="crayon-v">bucket</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">=</span><span class="crayon-v">cluster</span><span class="crayon-sy">.</span><span class="crayon-e">OpenBucket</span><span class="crayon-sy">(</span><span class="crayon-s">"restful-sample"</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040850537128346-5"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people"</span><span class="crayon-sy">,</span><span class="crayon-v">GetPeopleEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"GET"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040850537128346-6"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">GetPersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"GET"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040850537128346-7"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people"</span><span class="crayon-sy">,</span><span class="crayon-v">CreatePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"PUT"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040850537128346-8"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">UpdatePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"POST"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040850537128346-9"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">HandleFunc</span><span class="crayon-sy">(</span><span class="crayon-s">"/people/{id}"</span><span class="crayon-sy">,</span><span class="crayon-v">DeletePersonEndpoint</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Methods</span><span class="crayon-sy">(</span><span class="crayon-s">"DELETE"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040850537128346-10"><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">Fatal</span><span class="crayon-sy">(</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">ListenAndServe</span><span class="crayon-sy">(</span><span class="crayon-s">":12345"</span><span class="crayon-sy">,</span><span class="crayon-v">router</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>In the above&#xA0;<code>main</code> function we define our application router and establish a connection to our Couchbase cluster. &#xA0;In this case the Couchbase cluster is being run locally on my machine. &#xA0;With the Couchbase cluster connection established we can open a particular bucket. &#xA0;The bucket we use in this application will be called&#xA0;<code>restful-sample</code>.</p>
<p>There are five different routes in this application. &#xA0;There is a route for getting all documents, a route for getting a single document, a route for creating a document, a route for updating a document, and finally a route for deleting a document. &#xA0;Notice that each of these routes use&#xA0;<code>GET</code>,&#xA0;<code>PUT</code>,&#xA0;<code>POST</code>, or&#xA0;<code>DELETE</code>. &#xA0;Let&#x2019;s take a look at each of the endpoint functions that go with each of the routes.</p>
 
<div id="crayon-57a63d2040856397091538" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">$GOPATH/src/github.com/nraboy/cbproject/main.go</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d2040856397091538-1"><span class="crayon-st">func</span><span class="crayon-e">GetPersonEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040856397091538-2"><span class="crayon-st">var</span><span class="crayon-e">n1qlParams</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-st">interface</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-57a63d2040856397091538-3"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT create_a_simple_restful_api_with_golang.md data.json data_ml devops docker embedded gaming github go html javascript linux mobile png programming science social tidy url_to_filename.csv web_dev FROM `restful-sample` AS person WHERE META(person).id = $1"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040856397091538-4"><span class="crayon-v">params</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">mux</span><span class="crayon-sy">.</span><span class="crayon-e">Vars</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040856397091538-5"><span class="crayon-v">n1qlParams</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">,</span><span class="crayon-v">params</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040856397091538-6"><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">n1qlParams</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040856397091538-7"><span class="crayon-st">var</span><span class="crayon-e">row </span><span class="crayon-e">N1qlPerson</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d2040856397091538-8"><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-e">One</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d2040856397091538-9"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-v">Person</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>The above&#xA0;<code>GetPersonEndpoint</code> function will get a single person from the database. &#xA0;The document id from the meta information is being compared against the document id parameter that was passed in with the route request. &#xA0;This query is a parameterized query to prevent SQL injection. &#xA0;We are returning JSON data with only the&#xA0;<code>Person</code> struct, not the entire&#xA0;<code>N1qlPerson</code> struct.</p>
 
<div id="crayon-57a63d204085c960186766" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate">
<p class="crayon-toolbar"><span class="crayon-title">$GOPATH/src/github.com/nraboy/cbproject/main.go</span>
</p>


<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums ">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-57a63d204085c960186766-1"><span class="crayon-st">func</span><span class="crayon-e">GetPeopleEndpoint</span><span class="crayon-sy">(</span><span class="crayon-i">w</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">ResponseWriter</span><span class="crayon-sy">,</span><span class="crayon-e ">req *</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-v">Request</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d204085c960186766-2"><span class="crayon-st">var</span><span class="crayon-i">person</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-e">Person</span></p><p class="crayon-line" id="crayon-57a63d204085c960186766-3"><span class="crayon-v">query</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">gocb</span><span class="crayon-sy">.</span><span class="crayon-e">NewN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"SELECT create_a_simple_restful_api_with_golang.md data.json data_ml devops docker embedded gaming github go html javascript linux mobile png programming science social tidy url_to_filename.csv web_dev FROM `restful-sample` AS person"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d204085c960186766-4"><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-v">_</span><span class="crayon-o">:</span><span class="crayon-o">=</span><span class="crayon-v">bucket</span><span class="crayon-sy">.</span><span class="crayon-e">ExecuteN1qlQuery</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">,</span><span class="crayon-v">nil</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d204085c960186766-5"><span class="crayon-st">var</span><span class="crayon-e">row </span><span class="crayon-e">N1qlPerson</span></p><p class="crayon-line crayon-striped-line" id="crayon-57a63d204085c960186766-6"><span class="crayon-st">for</span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-e">Next</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-57a63d204085c960186766-7"><span class="crayon-v">person</span><span class="crayon-o">=</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">,</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-v">Person</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-57a63d204085c960186766-9"><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">NewEncoder</span><span class="crayon-sy">(</span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Encode</span><span class="crayon-sy">(</span><span class="crayon-v">person</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 

<p>The above&#xA0;<code>GetPeopleEndpoint</code> function is similar to the previous, but this time we are expecting a slice of results rather than a single result.</p>
<p>The create, update, and delete functions follow pretty much the same strategy, making things very easy to maintain and understand.</p>
<p>At this point the applicant can be run. &#xA0;When it comes to testing you&#x2019;ll have to use cURL, <a href="https://www.thepolyglotdeveloper.com/2015/01/using-postman-troubleshoot-restful-api-requests/" target="_blank">Postman</a>, or similar since the web browser cannot typically test&#xA0;<code>PUT</code>,&#xA0;<code>POST</code>, or&#xA0;<code>DELETE</code> endpoints out of the box.</p>
<h2>Conclusion</h2>
<p>You just saw how to take our previous <a href="https://www.thepolyglotdeveloper.com/2016/07/create-a-simple-restful-api-with-golang/" target="_blank">RESTful API GoLang example</a> to the next level by including <a href="http://www.couchbase.com" target="_blank">Couchbase Server</a> as our NoSQL document database. &#xA0;When using Couchbase, we are able to run SQL-like queries called N1QL queries to work with any data in the database. &#xA0;Although we don&#x2019;t have to use these N1QL queries, it makes things very easy and reduces a lot of potential parsing code.</p>
 </div> 
 
</div>
</body></html>
